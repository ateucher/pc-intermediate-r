<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-d6a2ae2cb249da1580f0a11f71b8f854.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-contrib/fontawesome6-6.7.2/all.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-6.7.2/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="Andy Teucher">
  <title>Parks Canada - Intermediate R – Programming with R: Iteration</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #97947a;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #97947a;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2; background-color: #2b2b2b; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #dcc6e0; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #ffd700; } /* Attribute */
    code span.bn { color: #dcc6e0; } /* BaseN */
    code span.bu { color: #f5ab35; } /* BuiltIn */
    code span.cf { color: #ffa07a; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffa07a; } /* Constant */
    code span.co { color: #d4d0ab; } /* Comment */
    code span.cv { color: #d4d0ab; font-style: italic; } /* CommentVar */
    code span.do { color: #d4d0ab; font-style: italic; } /* Documentation */
    code span.dt { color: #dcc6e0; } /* DataType */
    code span.dv { color: #dcc6e0; } /* DecVal */
    code span.er { color: #dcc6e0; } /* Error */
    code span.ex { color: #ffd700; } /* Extension */
    code span.fl { color: #f5ab35; } /* Float */
    code span.fu { color: #ffd700; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; } /* Keyword */
    code span.op { color: #00e0e0; } /* Operator */
    code span.ot { color: #ffa07a; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.sc { color: #00e0e0; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #f5ab35; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #d4d0ab; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-30a2a0ed8b387a71ee81c4eb70847720.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Programming with R: Iteration</h1>
  <p class="subtitle">Parks Canada; Ecological Integrity Monitoring Program</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Andy Teucher 
</div>
</div>
</div>

</section>
<section id="learning-objectives" class="slide level2">
<h2>Learning Objectives</h2>
<p>At the end of this section you will be able to:</p>
<div style="font-size: 80%;">
<ul>
<li>recognise that much iteration comes free with R</li>
<li>understand fundamentals of loops</li>
<li>use <code>purrr</code> functions for elegant iteration</li>
<li>understand functional programming and use anonymous functions with <code>purrr</code></li>
</ul>
</div>
</section>
<section id="what-is-iteration" class="slide level2">
<h2>What is iteration?</h2>
<ul>
<li><p>Iteration means repeating steps multiple times until a condition is met</p></li>
<li><p>In other languages, iteration is performed with loops: <code>for</code>, <code>while</code></p></li>
</ul>
<div class="fragment">
<ul>
<li><p>Iteration is different in R</p></li>
<li><p>You <em>can</em> use loops……. but you often don’t <em>need</em> to</p></li>
</ul>
</div>
</section>
<section id="iteration-in-r" class="slide level2">
<h2>Iteration in R</h2>
<p>Iteration is an inherent part of the <strong><code>R</code></strong> language. For example, if</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>nums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then</p>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="dv">2</span> <span class="sc">*</span> nums</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>is</p>
</div>
<div class="fragment">
<pre><code>[1]  6  2 12  8</code></pre>
<p>and NOT</p>
</div>
<div class="fragment">
<pre><code>[1] 3 1 6 4 3 1 6 4</code></pre>
</div>
<div class="fragment">
<p><strong>This is called vectorization</strong> - operations are automatically applied to each element of a vector.</p>
<aside class="notes">
<p>We take this for granted in R, but in most other programming languages, you would need to write a loop to achieve the same result. For example, in Python, you would typically use a list comprehension or a for loop to multiply each element of a list by 2. R’s vectorized operations make code more concise and often faster.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="meanwhile-with-python" class="slide level2">
<h2>Meanwhile with <code>python</code></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>nums <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">4</span>]</span>
<span id="cb5-2"><a></a></span>
<span id="cb5-3"><a></a>nums <span class="op">*</span> <span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>[3, 1, 6, 4, 3, 1, 6, 4]</code></pre>
<div class="fragment">
<p>To achieve the desired result:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>[x <span class="op">*</span> <span class="dv">2</span> <span class="cf">for</span> x <span class="kw">in</span> nums]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>[6, 2, 12, 8]</code></pre>
</div>
<div class="fragment">
<p>Or</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>y <span class="op">=</span> []</span>
<span id="cb9-2"><a></a><span class="cf">for</span> x <span class="kw">in</span> nums:</span>
<span id="cb9-3"><a></a>    y.append(x <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb9-4"><a></a>y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>[6, 2, 12, 8]</code></pre>
</div>
</section>
<section id="vectorization" class="slide level2">
<h2>Vectorization</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a></a></span>
<span id="cb11-3"><a></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a></a>  <span class="fu">mutate</span>(<span class="at">bill_ratio =</span> bill_len <span class="sc">/</span> bill_dep)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      species    island bill_len bill_dep flipper_len body_mass    sex year bill_ratio
1      Adelie Torgersen     39.1     18.7         181      3750   male 2007   2.090909
2      Adelie Torgersen     39.5     17.4         186      3800 female 2007   2.270115
3      Adelie Torgersen     40.3     18.0         195      3250 female 2007   2.238889
4      Adelie Torgersen       NA       NA          NA        NA   &lt;NA&gt; 2007         NA
5      Adelie Torgersen     36.7     19.3         193      3450 female 2007   1.901554
6      Adelie Torgersen     39.3     20.6         190      3650   male 2007   1.907767
7      Adelie Torgersen     38.9     17.8         181      3625 female 2007   2.185393
8      Adelie Torgersen     39.2     19.6         195      4675   male 2007   2.000000
9      Adelie Torgersen     34.1     18.1         193      3475   &lt;NA&gt; 2007   1.883978
10     Adelie Torgersen     42.0     20.2         190      4250   &lt;NA&gt; 2007   2.079208
11     Adelie Torgersen     37.8     17.1         186      3300   &lt;NA&gt; 2007   2.210526
12     Adelie Torgersen     37.8     17.3         180      3700   &lt;NA&gt; 2007   2.184971
13     Adelie Torgersen     41.1     17.6         182      3200 female 2007   2.335227
14     Adelie Torgersen     38.6     21.2         191      3800   male 2007   1.820755
15     Adelie Torgersen     34.6     21.1         198      4400   male 2007   1.639810
16     Adelie Torgersen     36.6     17.8         185      3700 female 2007   2.056180
17     Adelie Torgersen     38.7     19.0         195      3450 female 2007   2.036842
18     Adelie Torgersen     42.5     20.7         197      4500   male 2007   2.053140
19     Adelie Torgersen     34.4     18.4         184      3325 female 2007   1.869565
20     Adelie Torgersen     46.0     21.5         194      4200   male 2007   2.139535
21     Adelie    Biscoe     37.8     18.3         174      3400 female 2007   2.065574
22     Adelie    Biscoe     37.7     18.7         180      3600   male 2007   2.016043
23     Adelie    Biscoe     35.9     19.2         189      3800 female 2007   1.869792
24     Adelie    Biscoe     38.2     18.1         185      3950   male 2007   2.110497
25     Adelie    Biscoe     38.8     17.2         180      3800   male 2007   2.255814
26     Adelie    Biscoe     35.3     18.9         187      3800 female 2007   1.867725
27     Adelie    Biscoe     40.6     18.6         183      3550   male 2007   2.182796
28     Adelie    Biscoe     40.5     17.9         187      3200 female 2007   2.262570
29     Adelie    Biscoe     37.9     18.6         172      3150 female 2007   2.037634
30     Adelie    Biscoe     40.5     18.9         180      3950   male 2007   2.142857
31     Adelie     Dream     39.5     16.7         178      3250 female 2007   2.365269
32     Adelie     Dream     37.2     18.1         178      3900   male 2007   2.055249
33     Adelie     Dream     39.5     17.8         188      3300 female 2007   2.219101
34     Adelie     Dream     40.9     18.9         184      3900   male 2007   2.164021
35     Adelie     Dream     36.4     17.0         195      3325 female 2007   2.141176
36     Adelie     Dream     39.2     21.1         196      4150   male 2007   1.857820
37     Adelie     Dream     38.8     20.0         190      3950   male 2007   1.940000
38     Adelie     Dream     42.2     18.5         180      3550 female 2007   2.281081
39     Adelie     Dream     37.6     19.3         181      3300 female 2007   1.948187
40     Adelie     Dream     39.8     19.1         184      4650   male 2007   2.083770
41     Adelie     Dream     36.5     18.0         182      3150 female 2007   2.027778
42     Adelie     Dream     40.8     18.4         195      3900   male 2007   2.217391
43     Adelie     Dream     36.0     18.5         186      3100 female 2007   1.945946
44     Adelie     Dream     44.1     19.7         196      4400   male 2007   2.238579
45     Adelie     Dream     37.0     16.9         185      3000 female 2007   2.189349
46     Adelie     Dream     39.6     18.8         190      4600   male 2007   2.106383
47     Adelie     Dream     41.1     19.0         182      3425   male 2007   2.163158
48     Adelie     Dream     37.5     18.9         179      2975   &lt;NA&gt; 2007   1.984127
49     Adelie     Dream     36.0     17.9         190      3450 female 2007   2.011173
50     Adelie     Dream     42.3     21.2         191      4150   male 2007   1.995283
51     Adelie    Biscoe     39.6     17.7         186      3500 female 2008   2.237288
52     Adelie    Biscoe     40.1     18.9         188      4300   male 2008   2.121693
53     Adelie    Biscoe     35.0     17.9         190      3450 female 2008   1.955307
54     Adelie    Biscoe     42.0     19.5         200      4050   male 2008   2.153846
55     Adelie    Biscoe     34.5     18.1         187      2900 female 2008   1.906077
56     Adelie    Biscoe     41.4     18.6         191      3700   male 2008   2.225806
57     Adelie    Biscoe     39.0     17.5         186      3550 female 2008   2.228571
58     Adelie    Biscoe     40.6     18.8         193      3800   male 2008   2.159574
59     Adelie    Biscoe     36.5     16.6         181      2850 female 2008   2.198795
60     Adelie    Biscoe     37.6     19.1         194      3750   male 2008   1.968586
61     Adelie    Biscoe     35.7     16.9         185      3150 female 2008   2.112426
62     Adelie    Biscoe     41.3     21.1         195      4400   male 2008   1.957346
63     Adelie    Biscoe     37.6     17.0         185      3600 female 2008   2.211765
64     Adelie    Biscoe     41.1     18.2         192      4050   male 2008   2.258242
65     Adelie    Biscoe     36.4     17.1         184      2850 female 2008   2.128655
66     Adelie    Biscoe     41.6     18.0         192      3950   male 2008   2.311111
67     Adelie    Biscoe     35.5     16.2         195      3350 female 2008   2.191358
68     Adelie    Biscoe     41.1     19.1         188      4100   male 2008   2.151832
69     Adelie Torgersen     35.9     16.6         190      3050 female 2008   2.162651
70     Adelie Torgersen     41.8     19.4         198      4450   male 2008   2.154639
71     Adelie Torgersen     33.5     19.0         190      3600 female 2008   1.763158
72     Adelie Torgersen     39.7     18.4         190      3900   male 2008   2.157609
73     Adelie Torgersen     39.6     17.2         196      3550 female 2008   2.302326
74     Adelie Torgersen     45.8     18.9         197      4150   male 2008   2.423280
75     Adelie Torgersen     35.5     17.5         190      3700 female 2008   2.028571
76     Adelie Torgersen     42.8     18.5         195      4250   male 2008   2.313514
77     Adelie Torgersen     40.9     16.8         191      3700 female 2008   2.434524
78     Adelie Torgersen     37.2     19.4         184      3900   male 2008   1.917526
79     Adelie Torgersen     36.2     16.1         187      3550 female 2008   2.248447
80     Adelie Torgersen     42.1     19.1         195      4000   male 2008   2.204188
81     Adelie Torgersen     34.6     17.2         189      3200 female 2008   2.011628
82     Adelie Torgersen     42.9     17.6         196      4700   male 2008   2.437500
83     Adelie Torgersen     36.7     18.8         187      3800 female 2008   1.952128
84     Adelie Torgersen     35.1     19.4         193      4200   male 2008   1.809278
85     Adelie     Dream     37.3     17.8         191      3350 female 2008   2.095506
86     Adelie     Dream     41.3     20.3         194      3550   male 2008   2.034483
87     Adelie     Dream     36.3     19.5         190      3800   male 2008   1.861538
88     Adelie     Dream     36.9     18.6         189      3500 female 2008   1.983871
89     Adelie     Dream     38.3     19.2         189      3950   male 2008   1.994792
90     Adelie     Dream     38.9     18.8         190      3600 female 2008   2.069149
91     Adelie     Dream     35.7     18.0         202      3550 female 2008   1.983333
92     Adelie     Dream     41.1     18.1         205      4300   male 2008   2.270718
93     Adelie     Dream     34.0     17.1         185      3400 female 2008   1.988304
94     Adelie     Dream     39.6     18.1         186      4450   male 2008   2.187845
95     Adelie     Dream     36.2     17.3         187      3300 female 2008   2.092486
96     Adelie     Dream     40.8     18.9         208      4300   male 2008   2.158730
97     Adelie     Dream     38.1     18.6         190      3700 female 2008   2.048387
98     Adelie     Dream     40.3     18.5         196      4350   male 2008   2.178378
99     Adelie     Dream     33.1     16.1         178      2900 female 2008   2.055901
100    Adelie     Dream     43.2     18.5         192      4100   male 2008   2.335135
101    Adelie    Biscoe     35.0     17.9         192      3725 female 2009   1.955307
102    Adelie    Biscoe     41.0     20.0         203      4725   male 2009   2.050000
103    Adelie    Biscoe     37.7     16.0         183      3075 female 2009   2.356250
104    Adelie    Biscoe     37.8     20.0         190      4250   male 2009   1.890000
105    Adelie    Biscoe     37.9     18.6         193      2925 female 2009   2.037634
106    Adelie    Biscoe     39.7     18.9         184      3550   male 2009   2.100529
107    Adelie    Biscoe     38.6     17.2         199      3750 female 2009   2.244186
108    Adelie    Biscoe     38.2     20.0         190      3900   male 2009   1.910000
109    Adelie    Biscoe     38.1     17.0         181      3175 female 2009   2.241176
110    Adelie    Biscoe     43.2     19.0         197      4775   male 2009   2.273684
111    Adelie    Biscoe     38.1     16.5         198      3825 female 2009   2.309091
112    Adelie    Biscoe     45.6     20.3         191      4600   male 2009   2.246305
113    Adelie    Biscoe     39.7     17.7         193      3200 female 2009   2.242938
114    Adelie    Biscoe     42.2     19.5         197      4275   male 2009   2.164103
115    Adelie    Biscoe     39.6     20.7         191      3900 female 2009   1.913043
116    Adelie    Biscoe     42.7     18.3         196      4075   male 2009   2.333333
117    Adelie Torgersen     38.6     17.0         188      2900 female 2009   2.270588
118    Adelie Torgersen     37.3     20.5         199      3775   male 2009   1.819512
119    Adelie Torgersen     35.7     17.0         189      3350 female 2009   2.100000
120    Adelie Torgersen     41.1     18.6         189      3325   male 2009   2.209677
121    Adelie Torgersen     36.2     17.2         187      3150 female 2009   2.104651
122    Adelie Torgersen     37.7     19.8         198      3500   male 2009   1.904040
123    Adelie Torgersen     40.2     17.0         176      3450 female 2009   2.364706
124    Adelie Torgersen     41.4     18.5         202      3875   male 2009   2.237838
125    Adelie Torgersen     35.2     15.9         186      3050 female 2009   2.213836
126    Adelie Torgersen     40.6     19.0         199      4000   male 2009   2.136842
127    Adelie Torgersen     38.8     17.6         191      3275 female 2009   2.204545
128    Adelie Torgersen     41.5     18.3         195      4300   male 2009   2.267760
129    Adelie Torgersen     39.0     17.1         191      3050 female 2009   2.280702
130    Adelie Torgersen     44.1     18.0         210      4000   male 2009   2.450000
131    Adelie Torgersen     38.5     17.9         190      3325 female 2009   2.150838
132    Adelie Torgersen     43.1     19.2         197      3500   male 2009   2.244792
133    Adelie     Dream     36.8     18.5         193      3500 female 2009   1.989189
134    Adelie     Dream     37.5     18.5         199      4475   male 2009   2.027027
135    Adelie     Dream     38.1     17.6         187      3425 female 2009   2.164773
136    Adelie     Dream     41.1     17.5         190      3900   male 2009   2.348571
137    Adelie     Dream     35.6     17.5         191      3175 female 2009   2.034286
138    Adelie     Dream     40.2     20.1         200      3975   male 2009   2.000000
139    Adelie     Dream     37.0     16.5         185      3400 female 2009   2.242424
140    Adelie     Dream     39.7     17.9         193      4250   male 2009   2.217877
141    Adelie     Dream     40.2     17.1         193      3400 female 2009   2.350877
142    Adelie     Dream     40.6     17.2         187      3475   male 2009   2.360465
143    Adelie     Dream     32.1     15.5         188      3050 female 2009   2.070968
144    Adelie     Dream     40.7     17.0         190      3725   male 2009   2.394118
145    Adelie     Dream     37.3     16.8         192      3000 female 2009   2.220238
146    Adelie     Dream     39.0     18.7         185      3650   male 2009   2.085561
147    Adelie     Dream     39.2     18.6         190      4250   male 2009   2.107527
148    Adelie     Dream     36.6     18.4         184      3475 female 2009   1.989130
149    Adelie     Dream     36.0     17.8         195      3450 female 2009   2.022472
150    Adelie     Dream     37.8     18.1         193      3750   male 2009   2.088398
151    Adelie     Dream     36.0     17.1         187      3700 female 2009   2.105263
152    Adelie     Dream     41.5     18.5         201      4000   male 2009   2.243243
153    Gentoo    Biscoe     46.1     13.2         211      4500 female 2007   3.492424
154    Gentoo    Biscoe     50.0     16.3         230      5700   male 2007   3.067485
155    Gentoo    Biscoe     48.7     14.1         210      4450 female 2007   3.453901
156    Gentoo    Biscoe     50.0     15.2         218      5700   male 2007   3.289474
157    Gentoo    Biscoe     47.6     14.5         215      5400   male 2007   3.282759
158    Gentoo    Biscoe     46.5     13.5         210      4550 female 2007   3.444444
159    Gentoo    Biscoe     45.4     14.6         211      4800 female 2007   3.109589
160    Gentoo    Biscoe     46.7     15.3         219      5200   male 2007   3.052288
161    Gentoo    Biscoe     43.3     13.4         209      4400 female 2007   3.231343
162    Gentoo    Biscoe     46.8     15.4         215      5150   male 2007   3.038961
163    Gentoo    Biscoe     40.9     13.7         214      4650 female 2007   2.985401
164    Gentoo    Biscoe     49.0     16.1         216      5550   male 2007   3.043478
165    Gentoo    Biscoe     45.5     13.7         214      4650 female 2007   3.321168
166    Gentoo    Biscoe     48.4     14.6         213      5850   male 2007   3.315068
167    Gentoo    Biscoe     45.8     14.6         210      4200 female 2007   3.136986
168    Gentoo    Biscoe     49.3     15.7         217      5850   male 2007   3.140127
169    Gentoo    Biscoe     42.0     13.5         210      4150 female 2007   3.111111
170    Gentoo    Biscoe     49.2     15.2         221      6300   male 2007   3.236842
171    Gentoo    Biscoe     46.2     14.5         209      4800 female 2007   3.186207
172    Gentoo    Biscoe     48.7     15.1         222      5350   male 2007   3.225166
173    Gentoo    Biscoe     50.2     14.3         218      5700   male 2007   3.510490
174    Gentoo    Biscoe     45.1     14.5         215      5000 female 2007   3.110345
175    Gentoo    Biscoe     46.5     14.5         213      4400 female 2007   3.206897
176    Gentoo    Biscoe     46.3     15.8         215      5050   male 2007   2.930380
177    Gentoo    Biscoe     42.9     13.1         215      5000 female 2007   3.274809
178    Gentoo    Biscoe     46.1     15.1         215      5100   male 2007   3.052980
179    Gentoo    Biscoe     44.5     14.3         216      4100   &lt;NA&gt; 2007   3.111888
180    Gentoo    Biscoe     47.8     15.0         215      5650   male 2007   3.186667
181    Gentoo    Biscoe     48.2     14.3         210      4600 female 2007   3.370629
182    Gentoo    Biscoe     50.0     15.3         220      5550   male 2007   3.267974
183    Gentoo    Biscoe     47.3     15.3         222      5250   male 2007   3.091503
184    Gentoo    Biscoe     42.8     14.2         209      4700 female 2007   3.014085
185    Gentoo    Biscoe     45.1     14.5         207      5050 female 2007   3.110345
186    Gentoo    Biscoe     59.6     17.0         230      6050   male 2007   3.505882
187    Gentoo    Biscoe     49.1     14.8         220      5150 female 2008   3.317568
188    Gentoo    Biscoe     48.4     16.3         220      5400   male 2008   2.969325
189    Gentoo    Biscoe     42.6     13.7         213      4950 female 2008   3.109489
190    Gentoo    Biscoe     44.4     17.3         219      5250   male 2008   2.566474
191    Gentoo    Biscoe     44.0     13.6         208      4350 female 2008   3.235294
192    Gentoo    Biscoe     48.7     15.7         208      5350   male 2008   3.101911
193    Gentoo    Biscoe     42.7     13.7         208      3950 female 2008   3.116788
194    Gentoo    Biscoe     49.6     16.0         225      5700   male 2008   3.100000
195    Gentoo    Biscoe     45.3     13.7         210      4300 female 2008   3.306569
196    Gentoo    Biscoe     49.6     15.0         216      4750   male 2008   3.306667
197    Gentoo    Biscoe     50.5     15.9         222      5550   male 2008   3.176101
198    Gentoo    Biscoe     43.6     13.9         217      4900 female 2008   3.136691
199    Gentoo    Biscoe     45.5     13.9         210      4200 female 2008   3.273381
200    Gentoo    Biscoe     50.5     15.9         225      5400   male 2008   3.176101
201    Gentoo    Biscoe     44.9     13.3         213      5100 female 2008   3.375940
202    Gentoo    Biscoe     45.2     15.8         215      5300   male 2008   2.860759
203    Gentoo    Biscoe     46.6     14.2         210      4850 female 2008   3.281690
204    Gentoo    Biscoe     48.5     14.1         220      5300   male 2008   3.439716
205    Gentoo    Biscoe     45.1     14.4         210      4400 female 2008   3.131944
206    Gentoo    Biscoe     50.1     15.0         225      5000   male 2008   3.340000
207    Gentoo    Biscoe     46.5     14.4         217      4900 female 2008   3.229167
208    Gentoo    Biscoe     45.0     15.4         220      5050   male 2008   2.922078
209    Gentoo    Biscoe     43.8     13.9         208      4300 female 2008   3.151079
210    Gentoo    Biscoe     45.5     15.0         220      5000   male 2008   3.033333
211    Gentoo    Biscoe     43.2     14.5         208      4450 female 2008   2.979310
212    Gentoo    Biscoe     50.4     15.3         224      5550   male 2008   3.294118
213    Gentoo    Biscoe     45.3     13.8         208      4200 female 2008   3.282609
214    Gentoo    Biscoe     46.2     14.9         221      5300   male 2008   3.100671
215    Gentoo    Biscoe     45.7     13.9         214      4400 female 2008   3.287770
216    Gentoo    Biscoe     54.3     15.7         231      5650   male 2008   3.458599
217    Gentoo    Biscoe     45.8     14.2         219      4700 female 2008   3.225352
218    Gentoo    Biscoe     49.8     16.8         230      5700   male 2008   2.964286
219    Gentoo    Biscoe     46.2     14.4         214      4650   &lt;NA&gt; 2008   3.208333
220    Gentoo    Biscoe     49.5     16.2         229      5800   male 2008   3.055556
221    Gentoo    Biscoe     43.5     14.2         220      4700 female 2008   3.063380
222    Gentoo    Biscoe     50.7     15.0         223      5550   male 2008   3.380000
223    Gentoo    Biscoe     47.7     15.0         216      4750 female 2008   3.180000
224    Gentoo    Biscoe     46.4     15.6         221      5000   male 2008   2.974359
225    Gentoo    Biscoe     48.2     15.6         221      5100   male 2008   3.089744
226    Gentoo    Biscoe     46.5     14.8         217      5200 female 2008   3.141892
227    Gentoo    Biscoe     46.4     15.0         216      4700 female 2008   3.093333
228    Gentoo    Biscoe     48.6     16.0         230      5800   male 2008   3.037500
229    Gentoo    Biscoe     47.5     14.2         209      4600 female 2008   3.345070
230    Gentoo    Biscoe     51.1     16.3         220      6000   male 2008   3.134969
231    Gentoo    Biscoe     45.2     13.8         215      4750 female 2008   3.275362
232    Gentoo    Biscoe     45.2     16.4         223      5950   male 2008   2.756098
233    Gentoo    Biscoe     49.1     14.5         212      4625 female 2009   3.386207
234    Gentoo    Biscoe     52.5     15.6         221      5450   male 2009   3.365385
235    Gentoo    Biscoe     47.4     14.6         212      4725 female 2009   3.246575
236    Gentoo    Biscoe     50.0     15.9         224      5350   male 2009   3.144654
237    Gentoo    Biscoe     44.9     13.8         212      4750 female 2009   3.253623
238    Gentoo    Biscoe     50.8     17.3         228      5600   male 2009   2.936416
239    Gentoo    Biscoe     43.4     14.4         218      4600 female 2009   3.013889
240    Gentoo    Biscoe     51.3     14.2         218      5300   male 2009   3.612676
241    Gentoo    Biscoe     47.5     14.0         212      4875 female 2009   3.392857
242    Gentoo    Biscoe     52.1     17.0         230      5550   male 2009   3.064706
243    Gentoo    Biscoe     47.5     15.0         218      4950 female 2009   3.166667
244    Gentoo    Biscoe     52.2     17.1         228      5400   male 2009   3.052632
245    Gentoo    Biscoe     45.5     14.5         212      4750 female 2009   3.137931
246    Gentoo    Biscoe     49.5     16.1         224      5650   male 2009   3.074534
247    Gentoo    Biscoe     44.5     14.7         214      4850 female 2009   3.027211
248    Gentoo    Biscoe     50.8     15.7         226      5200   male 2009   3.235669
249    Gentoo    Biscoe     49.4     15.8         216      4925   male 2009   3.126582
250    Gentoo    Biscoe     46.9     14.6         222      4875 female 2009   3.212329
251    Gentoo    Biscoe     48.4     14.4         203      4625 female 2009   3.361111
252    Gentoo    Biscoe     51.1     16.5         225      5250   male 2009   3.096970
253    Gentoo    Biscoe     48.5     15.0         219      4850 female 2009   3.233333
254    Gentoo    Biscoe     55.9     17.0         228      5600   male 2009   3.288235
255    Gentoo    Biscoe     47.2     15.5         215      4975 female 2009   3.045161
256    Gentoo    Biscoe     49.1     15.0         228      5500   male 2009   3.273333
257    Gentoo    Biscoe     47.3     13.8         216      4725   &lt;NA&gt; 2009   3.427536
258    Gentoo    Biscoe     46.8     16.1         215      5500   male 2009   2.906832
259    Gentoo    Biscoe     41.7     14.7         210      4700 female 2009   2.836735
260    Gentoo    Biscoe     53.4     15.8         219      5500   male 2009   3.379747
261    Gentoo    Biscoe     43.3     14.0         208      4575 female 2009   3.092857
262    Gentoo    Biscoe     48.1     15.1         209      5500   male 2009   3.185430
263    Gentoo    Biscoe     50.5     15.2         216      5000 female 2009   3.322368
264    Gentoo    Biscoe     49.8     15.9         229      5950   male 2009   3.132075
265    Gentoo    Biscoe     43.5     15.2         213      4650 female 2009   2.861842
266    Gentoo    Biscoe     51.5     16.3         230      5500   male 2009   3.159509
267    Gentoo    Biscoe     46.2     14.1         217      4375 female 2009   3.276596
268    Gentoo    Biscoe     55.1     16.0         230      5850   male 2009   3.443750
269    Gentoo    Biscoe     44.5     15.7         217      4875   &lt;NA&gt; 2009   2.834395
270    Gentoo    Biscoe     48.8     16.2         222      6000   male 2009   3.012346
271    Gentoo    Biscoe     47.2     13.7         214      4925 female 2009   3.445255
272    Gentoo    Biscoe       NA       NA          NA        NA   &lt;NA&gt; 2009         NA
273    Gentoo    Biscoe     46.8     14.3         215      4850 female 2009   3.272727
274    Gentoo    Biscoe     50.4     15.7         222      5750   male 2009   3.210191
275    Gentoo    Biscoe     45.2     14.8         212      5200 female 2009   3.054054
276    Gentoo    Biscoe     49.9     16.1         213      5400   male 2009   3.099379
277 Chinstrap     Dream     46.5     17.9         192      3500 female 2007   2.597765
278 Chinstrap     Dream     50.0     19.5         196      3900   male 2007   2.564103
279 Chinstrap     Dream     51.3     19.2         193      3650   male 2007   2.671875
280 Chinstrap     Dream     45.4     18.7         188      3525 female 2007   2.427807
281 Chinstrap     Dream     52.7     19.8         197      3725   male 2007   2.661616
282 Chinstrap     Dream     45.2     17.8         198      3950 female 2007   2.539326
283 Chinstrap     Dream     46.1     18.2         178      3250 female 2007   2.532967
284 Chinstrap     Dream     51.3     18.2         197      3750   male 2007   2.818681
285 Chinstrap     Dream     46.0     18.9         195      4150 female 2007   2.433862
286 Chinstrap     Dream     51.3     19.9         198      3700   male 2007   2.577889
287 Chinstrap     Dream     46.6     17.8         193      3800 female 2007   2.617978
288 Chinstrap     Dream     51.7     20.3         194      3775   male 2007   2.546798
289 Chinstrap     Dream     47.0     17.3         185      3700 female 2007   2.716763
290 Chinstrap     Dream     52.0     18.1         201      4050   male 2007   2.872928
291 Chinstrap     Dream     45.9     17.1         190      3575 female 2007   2.684211
292 Chinstrap     Dream     50.5     19.6         201      4050   male 2007   2.576531
293 Chinstrap     Dream     50.3     20.0         197      3300   male 2007   2.515000
294 Chinstrap     Dream     58.0     17.8         181      3700 female 2007   3.258427
295 Chinstrap     Dream     46.4     18.6         190      3450 female 2007   2.494624
296 Chinstrap     Dream     49.2     18.2         195      4400   male 2007   2.703297
297 Chinstrap     Dream     42.4     17.3         181      3600 female 2007   2.450867
298 Chinstrap     Dream     48.5     17.5         191      3400   male 2007   2.771429
299 Chinstrap     Dream     43.2     16.6         187      2900 female 2007   2.602410
300 Chinstrap     Dream     50.6     19.4         193      3800   male 2007   2.608247
301 Chinstrap     Dream     46.7     17.9         195      3300 female 2007   2.608939
302 Chinstrap     Dream     52.0     19.0         197      4150   male 2007   2.736842
303 Chinstrap     Dream     50.5     18.4         200      3400 female 2008   2.744565
304 Chinstrap     Dream     49.5     19.0         200      3800   male 2008   2.605263
305 Chinstrap     Dream     46.4     17.8         191      3700 female 2008   2.606742
306 Chinstrap     Dream     52.8     20.0         205      4550   male 2008   2.640000
307 Chinstrap     Dream     40.9     16.6         187      3200 female 2008   2.463855
308 Chinstrap     Dream     54.2     20.8         201      4300   male 2008   2.605769
309 Chinstrap     Dream     42.5     16.7         187      3350 female 2008   2.544910
310 Chinstrap     Dream     51.0     18.8         203      4100   male 2008   2.712766
311 Chinstrap     Dream     49.7     18.6         195      3600   male 2008   2.672043
312 Chinstrap     Dream     47.5     16.8         199      3900 female 2008   2.827381
313 Chinstrap     Dream     47.6     18.3         195      3850 female 2008   2.601093
314 Chinstrap     Dream     52.0     20.7         210      4800   male 2008   2.512077
315 Chinstrap     Dream     46.9     16.6         192      2700 female 2008   2.825301
316 Chinstrap     Dream     53.5     19.9         205      4500   male 2008   2.688442
317 Chinstrap     Dream     49.0     19.5         210      3950   male 2008   2.512821
318 Chinstrap     Dream     46.2     17.5         187      3650 female 2008   2.640000
319 Chinstrap     Dream     50.9     19.1         196      3550   male 2008   2.664921
320 Chinstrap     Dream     45.5     17.0         196      3500 female 2008   2.676471
321 Chinstrap     Dream     50.9     17.9         196      3675 female 2009   2.843575
322 Chinstrap     Dream     50.8     18.5         201      4450   male 2009   2.745946
323 Chinstrap     Dream     50.1     17.9         190      3400 female 2009   2.798883
324 Chinstrap     Dream     49.0     19.6         212      4300   male 2009   2.500000
325 Chinstrap     Dream     51.5     18.7         187      3250   male 2009   2.754011
326 Chinstrap     Dream     49.8     17.3         198      3675 female 2009   2.878613
327 Chinstrap     Dream     48.1     16.4         199      3325 female 2009   2.932927
328 Chinstrap     Dream     51.4     19.0         201      3950   male 2009   2.705263
329 Chinstrap     Dream     45.7     17.3         193      3600 female 2009   2.641618
330 Chinstrap     Dream     50.7     19.7         203      4050   male 2009   2.573604
331 Chinstrap     Dream     42.5     17.3         187      3350 female 2009   2.456647
332 Chinstrap     Dream     52.2     18.8         197      3450   male 2009   2.776596
333 Chinstrap     Dream     45.2     16.6         191      3250 female 2009   2.722892
334 Chinstrap     Dream     49.3     19.9         203      4050   male 2009   2.477387
335 Chinstrap     Dream     50.2     18.8         202      3800   male 2009   2.670213
336 Chinstrap     Dream     45.6     19.4         194      3525 female 2009   2.350515
337 Chinstrap     Dream     51.9     19.5         206      3950   male 2009   2.661538
338 Chinstrap     Dream     46.8     16.5         189      3650 female 2009   2.836364
339 Chinstrap     Dream     45.7     17.0         195      3650 female 2009   2.688235
340 Chinstrap     Dream     55.8     19.8         207      4000   male 2009   2.818182
341 Chinstrap     Dream     43.5     18.1         202      3400 female 2009   2.403315
342 Chinstrap     Dream     49.6     18.2         193      3775   male 2009   2.725275
343 Chinstrap     Dream     50.8     19.0         210      4100   male 2009   2.673684
344 Chinstrap     Dream     50.2     18.7         198      3775 female 2009   2.684492</code></pre>
</div>
</div>
</section>
<section id="iteration-in-r-1" class="slide level2">
<h2>Iteration in R</h2>
<p>We also have:</p>
<ul>
<li><p><code>group_by()</code> with <code>summarize()</code> <em>(for every group, do this summary)</em></p></li>
<li><p><code>ggplot2::facet_wrap()</code> <em>(for every level of a factor, make a plot)</em></p></li>
<li><p><code>*apply()</code> and <code>purrr::map*()</code> and <em>(for every element of a list/vector, do this function)</em></p></li>
</ul>
</section>
<section id="why-iteration" class="slide level2">
<h2>Why iteration?</h2>
<p>Doing the same operation multiple times:</p>
<ul>
<li>Process multiple files</li>
<li>Analyze data from multiple sites</li>
<li>Apply the same transformation to multiple columns</li>
<li>Run simulations</li>
</ul>
<div class="fragment">
<p><strong>Goal</strong>: Write code that is:</p>
<ul>
<li>Less repetitive</li>
<li>Easier to maintain</li>
<li>Harder to make mistakes in</li>
</ul>
</div>
</section>
<section>
<section id="loops" class="title-slide slide level1 center">
<h1>Loops</h1>

</section>
<section id="basic-for-loop-syntax" class="slide level2">
<h2>Basic <code>for</code> loop syntax</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="cf">for</span> (item <span class="cf">in</span> vector_or_list) {</span>
<span id="cb13-2"><a></a>  <span class="co"># item takes on each value in vector</span></span>
<span id="cb13-3"><a></a>  <span class="co"># Do something with item</span></span>
<span id="cb13-4"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br></p>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>parks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Banff"</span>, <span class="st">"Jasper"</span>, <span class="st">"Yoho"</span>, <span class="st">"Riding Mountain"</span>)</span>
<span id="cb14-2"><a></a></span>
<span id="cb14-3"><a></a><span class="cf">for</span> (park <span class="cf">in</span> parks) {</span>
<span id="cb14-4"><a></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Processing"</span>, park))</span>
<span id="cb14-5"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Processing Banff"
[1] "Processing Jasper"
[1] "Processing Yoho"
[1] "Processing Riding Mountain"</code></pre>
</div>
</div>
</div>
</section>
<section id="loop-over-values-vs-indices" class="slide level2">
<h2>Loop over values vs indices</h2>
<p><strong>Loop over values</strong> when you only need the <em>value</em> of each element.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>parks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Banff"</span>, <span class="st">"Jasper"</span>, <span class="st">"Yoho"</span>, <span class="st">"Riding Mountain"</span>)</span>
<span id="cb16-2"><a></a></span>
<span id="cb16-3"><a></a><span class="cf">for</span> (park <span class="cf">in</span> parks) {</span>
<span id="cb16-4"><a></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Processing"</span>, park))</span>
<span id="cb16-5"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Processing Banff"
[1] "Processing Jasper"
[1] "Processing Yoho"
[1] "Processing Riding Mountain"</code></pre>
</div>
</div>
<div class="fragment">
<p><strong>Loop over indices</strong> when you need to know the <em>position</em>.</p>
</div>
</section>
<section id="when-to-use-indices" class="slide level2">
<h2>When to use indices</h2>
<p>Use <code>seq_along()</code>, <code>seq_len()</code>, <code>seq()</code> when you need to:</p>
<ol type="1">
<li><strong>Access the same position in multiple objects</strong>:</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>parks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Banff"</span>, <span class="st">"Jasper"</span>, <span class="st">"Yoho"</span>, <span class="st">"Riding Mountain"</span>)</span>
<span id="cb18-2"><a></a>provinces <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alberta"</span>, <span class="st">"Alberta"</span>, <span class="st">"British Columbia"</span>, <span class="st">"Manitoba"</span>)</span>
<span id="cb18-3"><a></a></span>
<span id="cb18-4"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(parks)) {</span>
<span id="cb18-5"><a></a>  <span class="fu">print</span>(<span class="fu">paste</span>(parks[i], <span class="st">"is in"</span>, provinces[i]))</span>
<span id="cb18-6"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Banff is in Alberta"
[1] "Jasper is in Alberta"
[1] "Yoho is in British Columbia"
[1] "Riding Mountain is in Manitoba"</code></pre>
</div>
</div>
<div class="fragment">
<ol start="2" type="1">
<li><strong>Store results at specific positions</strong>:</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>results <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(files))</span>
<span id="cb20-2"><a></a></span>
<span id="cb20-3"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(files)) {</span>
<span id="cb20-4"><a></a>  results[[i]] <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(files[i])</span>
<span id="cb20-5"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="example-reading-multiple-files" class="slide level2">
<h2>Example: Reading multiple files</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">library</span>(readr)</span>
<span id="cb21-2"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-3"><a></a></span>
<span id="cb21-4"><a></a>files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data/"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-5"><a></a></span>
<span id="cb21-6"><a></a>data_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">length</span>(files))</span>
<span id="cb21-7"><a></a></span>
<span id="cb21-8"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(files)) {</span>
<span id="cb21-9"><a></a>  data_list[[i]] <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(files[i])</span>
<span id="cb21-10"><a></a>}</span>
<span id="cb21-11"><a></a></span>
<span id="cb21-12"><a></a><span class="co"># Combine into one data frame</span></span>
<span id="cb21-13"><a></a>all_data <span class="ot">&lt;-</span> <span class="fu">rbind_list</span>(data_list)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="your-turn-create-a-for-loop-to-make-and-save-plots-for-each-rodent-site-plot" class="slide level2">
<h2>Your Turn: Create a <code>for</code> loop to make and save plots for each rodent site (plot)</h2>
<p>Starting code in <code>04-iteration.R</code></p>
<p><br></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>rodents <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"PortalData/Rodents/Portal_rodent.csv"</span>)</span>
<span id="cb22-2"><a></a></span>
<span id="cb22-3"><a></a>rodent_counts <span class="ot">&lt;-</span> rodents <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"DM"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a></a>  <span class="fu">group_by</span>(year, plot) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="while-loops" class="slide level2">
<h2><code>while</code> loops</h2>
<ul>
<li>Loop continues <em>while</em> the condition is <code>TRUE</code></li>
<li>Stops when the condition is <code>FALSE</code>.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="cf">while</span> (condition_is_true) {</span>
<span id="cb23-2"><a></a>  <span class="co"># Do something</span></span>
<span id="cb23-3"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-2"><a></a><span class="cf">while</span> (i <span class="sc">&lt;</span> <span class="dv">6</span>) {</span>
<span id="cb24-3"><a></a>  <span class="fu">print</span>(i)</span>
<span id="cb24-4"><a></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-5"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5</code></pre>
</div>
</div>
</div>
</div></div>
<div class="fragment">
<p>Use when you don’t know in advance how many iterations you’ll need.</p>
</div>
<div class="fragment">
<p>Usually need to advance the iterator inside the loop.</p>
</div>
</section>
<section id="while-loop-example-simulation" class="slide level2">
<h2>While loop example: Simulation</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="co"># Simulate until estimate stabilizes</span></span>
<span id="cb26-2"><a></a>estimate <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-3"><a></a>previous <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb26-4"><a></a>tolerance <span class="ot">&lt;-</span> <span class="fl">0.001</span></span>
<span id="cb26-5"><a></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb26-6"><a></a>reps <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-7"><a></a></span>
<span id="cb26-8"><a></a><span class="cf">while</span> (<span class="fu">abs</span>(estimate <span class="sc">-</span> previous) <span class="sc">&gt;</span> tolerance) {</span>
<span id="cb26-9"><a></a>  previous <span class="ot">&lt;-</span> estimate</span>
<span id="cb26-10"><a></a>  sample_data <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb26-11"><a></a>  estimate <span class="ot">&lt;-</span> <span class="fu">mean</span>(sample_data)</span>
<span id="cb26-12"><a></a>  n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb26-13"><a></a>  reps <span class="ot">&lt;-</span> reps <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb26-14"><a></a>}</span>
<span id="cb26-15"><a></a>n</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8800</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>reps</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 87</code></pre>
</div>
</div>
<aside class="notes">
<p>This code simulates data repeatedly until the estimated mean stabilizes within a tolerance threshold:</p>
<p>Initialize: Start with an estimate of 0, track the previous estimate, set a tolerance of 0.001, and begin with sample size 100</p>
<p>Loop: Continue while the change in estimate exceeds the tolerance</p>
<p>Save current estimate as previous Generate random normal data (mean=5, sd=2) with current sample size Calculate new estimate (mean of sample) Increase sample size by 100 Result: Stops when consecutive estimates differ by less than 0.001</p>
<p>This demonstrates the law of large numbers - as sample size increases, the sample mean converges to the true population mean (5). The loop automatically determines how many observations are needed for the estimate to stabilize.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>Rarely needed in data analysis work.</p>
</section></section>
<section>
<section id="iterating-with-purrr" class="title-slide slide level1 center">
<h1>Iterating with <code>{purrr}</code></h1>

</section>
<section id="functional-programming" class="slide level2">
<h2>Functional programming</h2>
<p>“functional programming” because functions take other functions as input</p>
<ul>
<li><p>modifying multiple columns <code>dplyr::across()</code></p></li>
<li><p>reading multiple files <code>purrr::map()</code> and friends</p></li>
<li><p>saving multiple outputs <code>purrr::walk()</code></p></li>
</ul>
</section>
<section id="why-purrr" class="slide level2">
<h2>Why <code>purrr</code>?</h2>
<p>The <code>purrr</code> package provides tools for functional programming:</p>
<ul>
<li>Clearer intent than loops</li>
<li>Less boilerplate code</li>
<li>Type-safe variants</li>
<li>Works seamlessly with pipes</li>
</ul>
</section>
<section id="fundamental-paradigms" class="slide level2">
<h2>Fundamental paradigms</h2>
<p>Functional programming has three fundamental paradigms; they act on lists or vectors:</p>
<ul>
<li class="fragment"><code>map</code> - do <em>this</em> to each element: <code>purrr::map()</code></li>
<li class="fragment"><code>filter</code> - like spaghetti, not coffee: <code>purrr::keep()</code></li>
<li class="fragment"><code>reduce</code> - combine into new thing: <code>purrr::reduce()</code></li>
</ul>
<div class="fragment">
<p>Each of these takes a <em>function</em> as an argument, to tell the operator <em>what</em> to do.</p>
</div>
<div class="fragment">
<p>We are going to focus on <code>map()</code> and friends.</p>
</div>
</section>
<section id="map-apply-a-function-to-each-element" class="slide level2">
<h2><code>map()</code>: Apply a function to each element</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>parks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Banff"</span>, <span class="st">"Jasper"</span>, <span class="st">"Yoho"</span>, <span class="st">"Riding Mountain"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment">
<h3 id="for-loop"><code>for</code> loop:</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="cf">for</span> (park <span class="cf">in</span> parks) {</span>
<span id="cb31-2"><a></a>  <span class="fu">print</span>(<span class="fu">nchar</span>(park))</span>
<span id="cb31-3"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5
[1] 6
[1] 4
[1] 15</code></pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment">
<h3 id="map"><code>map()</code></h3>
<p><code>map(.x, .f)</code> applies function <code>.f</code> to each element of <code>.x</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="fu">map</span>(parks, nchar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 5

[[2]]
[1] 6

[[3]]
[1] 4

[[4]]
[1] 15</code></pre>
</div>
</div>
<div class="fragment">
<p>Returns a <strong>list</strong> by default.</p>
</div>
</div>
</div></div>
</section>
<section id="aside-review-of-lists" class="slide level2">
<h2>Aside: Review of lists</h2>
<p>Lists are like vectors, but instead of each element being a single value, each element can be a more complex object (vector, data-frame, function, etc.)</p>
<p>Lists can have <code>names</code></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>my_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb35-2"><a></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb35-3"><a></a>  <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),</span>
<span id="cb35-4"><a></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>))</span>
<span id="cb35-5"><a></a>)</span>
<span id="cb35-6"><a></a>my_list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 2 3

[[2]]
[1] "a" "b" "c"

[[3]]
  x y
1 1 A
2 2 B
3 3 C</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>my_named_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-2"><a></a>  <span class="at">numbers =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb37-3"><a></a>  <span class="at">letters =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),</span>
<span id="cb37-4"><a></a>  <span class="at">df =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>))</span>
<span id="cb37-5"><a></a>)</span>
<span id="cb37-6"><a></a>my_named_list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$numbers
[1] 1 2 3

$letters
[1] "a" "b" "c"

$df
  x y
1 1 A
2 2 B
3 3 C</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">names</span>(my_named_list)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numbers" "letters" "df"     </code></pre>
</div>
</div>
</div></div>
<aside class="notes">
<p>Let’s make and explore this object in R</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="type-specific-map-variants" class="slide level2">
<h2>Type-specific map variants</h2>
<p><code>map_*()</code> functions return <strong><em>atomic</em> vectors</strong> of specific types:</p>
<ul>
<li><code>map_dbl()</code> → numeric vector</li>
<li><code>map_chr()</code> → character vector</li>
<li><code>map_int()</code> → integer vector</li>
<li><code>map_lgl()</code> → logical vector</li>
</ul>
</section>
<section id="type-specific-map-variants-1" class="slide level2">
<h2>Type-specific map variants</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="fu">map_dbl</span>(parks, nchar)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  5  6  4 15</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a><span class="fu">map_chr</span>(parks, toupper)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "BANFF"           "JASPER"          "YOHO"            "RIDING MOUNTAIN"</code></pre>
</div>
</div>
<p><br></p>
</div>
<div class="fragment">
<p><strong>Note:</strong> These are simple examples to illustrate, but <code>nchar()</code> and <code>toupper()</code> are already vectorized, so you wouldn’t normally use <code>map()</code> for them.</p>
<p><br></p>
</div>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a><span class="fu">nchar</span>(parks)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  5  6  4 15</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a><span class="fu">toupper</span>(parks)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "BANFF"           "JASPER"          "YOHO"            "RIDING MOUNTAIN"</code></pre>
</div>
</div>
</div>
</section>
<section id="anonymous-functions" class="slide level2">
<h2>Anonymous functions</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a><span class="fu">map</span>(.x, .f)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>.f</code> argument to <code>map()</code> can be:</p>
<ul>
<li>a named function (e.g., <code>nchar</code>, <code>toupper</code>)</li>
<li>an anonymous function (a function defined <em>in place</em>)</li>
</ul>
</section>
<section id="syntax-for-anonymous-functions" class="slide level2">
<h2>Syntax for anonymous functions:</h2>
<div class="columns">
<div class="column">
<p>If simple, on one line:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a></a>\(x) what to do with x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br></p>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a>num <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb51-2"><a></a><span class="fu">map</span>(num, \(x) x <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2

[[2]]
[1] 3

[[3]]
[1] 4

[[4]]
[1] 5</code></pre>
</div>
</div>
</div>
</div><div class="column">
<div class="fragment">
<p>Or more complex:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>\(arg1, arg2, ...) {</span>
<span id="cb53-2"><a></a>  <span class="co"># function body</span></span>
<span id="cb53-3"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br></p>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a></a>num <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb54-2"><a></a><span class="fu">map</span>(num, \(x) {</span>
<span id="cb54-3"><a></a>  y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb54-4"><a></a>  z <span class="ot">&lt;-</span> y <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb54-5"><a></a>  z</span>
<span id="cb54-6"><a></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 4

[[2]]
[1] 7

[[3]]
[1] 12

[[4]]
[1] 19</code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section id="map-atomic-variants" class="slide level2">
<h2>Map: Atomic variants</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>map()</code> always returns a list:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a>num <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb56-2"><a></a><span class="fu">map</span>(num, \(x) x <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2

[[2]]
[1] 3

[[3]]
[1] 4

[[4]]
[1] 5</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Use an atomic variant to specify type:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a>num <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb58-2"><a></a><span class="fu">map_int</span>(num, \(x) x <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5</code></pre>
</div>
</div>
</div></div>
</section>
<section id="reading-multiple-files" class="slide level2">
<h2>Reading multiple files</h2>
<p>Iteration functions in {purrr} can help with repetitive tasks.</p>
<div class="fragment">
<h3 id="example">Example</h3>
<p>Read Excel files from a directory, then combine into a single data-frame.</p>
</div>
</section>
<section id="our-turn-reading-data-manually" class="slide level2">
<h2>Our turn: Reading data manually</h2>
<p>Here’s our starting code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>data1952 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/gapminder/1952.xlsx"</span>)</span>
<span id="cb60-2"><a></a>data1957 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/gapminder/1957.xlsx"</span>)</span>
<span id="cb60-3"><a></a>data1962 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/gapminder/1952.xlsx"</span>)</span>
<span id="cb60-4"><a></a>data1967 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/gapminder/1967.xlsx"</span>)</span>
<span id="cb60-5"><a></a></span>
<span id="cb60-6"><a></a>data_manual <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data1952, data1957, data1962, data1967)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="fragment">
<p>What problems do you see?</p>
<p>(I see one real problem, and one philosophical problem)</p>
<p><br></p>
</div>
<div class="fragment">
<p>Starting code in <code>04-iteration.R</code></p>
</div>
</section>
<section id="our-turn-make-list-of-paths" class="slide level2">
<h2>Our turn: Make list of paths</h2>
<p>I see this as a two step problem:</p>
<ul>
<li class="fragment">make a named list of paths, name is year</li>
<li class="fragment">use list of paths to read data frames, combine</li>
</ul>
<div class="fragment">
<p>Let’s work together to improve this code to get paths:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a>paths <span class="ot">&lt;-</span></span>
<span id="cb61-2"><a></a>  <span class="co"># get the filepaths from the directory</span></span>
<span id="cb61-3"><a></a>  fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">"data/gapminder"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a></a>  <span class="co"># extract the year as names</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="our-turn-read-data" class="slide level2">
<h2>Our turn: Read data</h2>
<p>Let’s work together to improve this code to read data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a></a>data <span class="ot">&lt;-</span></span>
<span id="cb62-2"><a></a>  paths <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a></a>  <span class="co"># read each file from excel, into data frame</span></span>
<span id="cb62-4"><a></a>  <span class="co"># set list-names as column `year`</span></span>
<span id="cb62-5"><a></a>  <span class="co"># bind into single data-frame</span></span>
<span id="cb62-6"><a></a>  <span class="co"># convert year to number</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="map-over-two-inputs" class="slide level2">
<h2>Map over two inputs</h2>
<p>Sometimes you need to map over two inputs that are the same length.</p>
<p>Use <code>map2()</code> with two inputs, and supply a function that takes two arguments.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a>params1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb63-2"><a></a>params2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb63-3"><a></a></span>
<span id="cb63-4"><a></a><span class="fu">map2</span>(</span>
<span id="cb63-5"><a></a>  params1,</span>
<span id="cb63-6"><a></a>  params2,</span>
<span id="cb63-7"><a></a>  \(x, y) x <span class="sc">+</span> y</span>
<span id="cb63-8"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 22

[[3]]
[1] 33</code></pre>
</div>
</div>
<div class="fragment">
<p><strong>Vector variants:</strong> <code>map2_dbl()</code>, <code>map2_chr()</code>, etc.</p>
<p><strong>See <code>pmap()</code> for more than two inputs.</strong></p>
</div>
</section>
<section id="purrrwalk" class="slide level2">
<h2><code>purrr::walk()</code></h2>
<p>For functions called for their <em>side effects</em> (i.e., not for their return value)</p>
<p>Useful for:</p>
<ul>
<li>writing data files</li>
<li>saving plots</li>
<li><code>walk2()</code> for two inputs</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a></a><span class="fu">walk2</span>(</span>
<span id="cb65-2"><a></a>  list_of_dataframes,</span>
<span id="cb65-3"><a></a>  list_of_filepaths,</span>
<span id="cb65-4"><a></a>  \(df, f) {</span>
<span id="cb65-5"><a></a>    <span class="fu">write_csv</span>(df, f)</span>
<span id="cb65-6"><a></a>  }</span>
<span id="cb65-7"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="your-turn" class="slide level2">
<h2>Your turn</h2>
<p>Using our first example with the rodent data, use <code>purrr</code> instead of a <code>for</code> loop to:</p>
<ol type="1">
<li>Make a list of plots</li>
<li>Save plots for each rodent site (plot)</li>
</ol>
<p><br></p>
<div class="fragment">
<p>Starting code in <code>04-iteration.R</code></p>
</div>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li><strong>Loops</strong> are explicit but verbose</li>
<li><strong>Functional programming</strong> (<code>purrr</code>) is usually clearer and efficient</li>
<li>Use <code>map_*()</code> to iterate over lists/vectors</li>
<li>Use <code>walk()</code> (and variants) for side effects</li>
<li><code>purrr</code> functions can be parallelized with <code>in_parallel()</code></li>
</ul>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<ul>
<li>R4DS chapter on iteration: <a href="https://r4ds.hadley.nz/iteration" class="uri">https://r4ds.hadley.nz/iteration</a></li>
<li>purrr documentation: <a href="https://purrr.tidyverse.org/" class="uri">https://purrr.tidyverse.org/</a></li>
<li>tidyverse blog on purrr: <a href="https://tidyverse.org/blog/2023/05/purrr-walk-this-way/" class="uri">https://tidyverse.org/blog/2023/05/purrr-walk-this-way/</a></li>
<li>Parallel processing with purrr: <a href="https://purrr.tidyverse.org/articles/parallel.html" class="uri">https://purrr.tidyverse.org/articles/parallel.html</a></li>
</ul>
</section>
<section id="another-example" class="slide level2">
<h2>Another example</h2>
<p>See <a href="https://github.com/ateucher/pc-programming/blob/main/solutions/07-advanced-iteration.qmd" class="uri">https://github.com/ateucher/pc-programming/blob/main/solutions/07-advanced-iteration.qmd</a> for an example of using <code>purrr</code> to conduct a power analysis on rodent data in Quarto. It includes a section on running it in parallel.</p>
<p>The rendered report is at <a href="https://github.com/ateucher/pc-programming/blob/main/solutions/07-advanced-iteration.pdf" class="uri">https://github.com/ateucher/pc-programming/blob/main/solutions/07-advanced-iteration.pdf</a></p>


<script> window._input_file = "---\n" + "title: \"Programming with R: Iteration\"\n" + "subtitle: \"Parks Canada; Ecological Integrity Monitoring Program\"\n" + "author: \"Andy Teucher\"\n" + "format: revealjs\n" + "knitr:\n" + "  opts_chunk: \n" + "    R.options:\n" + "      width: 110\n" + "      pillar.print_max: 5\n" + "      pillar.print_min: 5\n" + "    echo: true\n" + "---\n" + "\n" + "## Learning Objectives\n" + "\n" + "At the end of this section you will be able to:\n" + "\n" + "::: {style=\"font-size: 80%;\"}\n" + "\n" + "- recognise that much iteration comes free with R\n" + "- understand fundamentals of loops\n" + "- use `purrr` functions for elegant iteration\n" + "- understand functional programming and use anonymous functions with `purrr`\n" + "\n" + "```{r}\n" + "#| include: false\n" + "library(purrr)\n" + "```\n" + "\n" + ":::\n" + "\n" + "## What is iteration?\n" + "\n" + "-   Iteration means repeating steps multiple times until a condition is\n" + "    met\n" + "\n" + "-   In other languages, iteration is performed with loops: `for`, `while`\n" + "\n" + ". . .\n" + "\n" + "-   Iteration is different in R\n" + "\n" + "-   You *can* use loops....... but you often don't *need* to\n" + "\n" + "## Iteration in R\n" + "\n" + "Iteration is an inherent part of the **`R`** language. For example, if\n" + "\n" + "```{r}\n" + "nums <- c(3, 1, 6, 4)\n" + "```\n" + "\n" + "Then\n" + "\n" + ". . .\n" + "\n" + "```{r}\n" + "#| eval: false\n" + "2 * nums\n" + "```\n" + "\n" + "is\n" + "\n" + ". . .\n" + "\n" + "```\n" + "[1]  6  2 12  8\n" + "```\n" + "\n" + "and NOT\n" + "\n" + ". . .\n" + "\n" + "```\n" + "[1] 3 1 6 4 3 1 6 4\n" + "```\n" + "\n" + ". . .\n" + "\n" + "**This is called vectorization** - operations are automatically applied to each element of a vector.\n" + "\n" + "::: {.notes}\n" + "We take this for granted in R, but in most other programming languages, you would need to write a loop to achieve the same result. For example, in Python, you would typically use a list comprehension or a for loop to multiply each element of a list by 2. R's vectorized operations make code more concise and often faster.\n" + ":::\n" + "\n" + "## Meanwhile with `python`\n" + "\n" + "```python\n" + "nums = [3,1,6,4]\n" + "\n" + "nums * 2\n" + "```\n" + "\n" + "```\n" + "[3, 1, 6, 4, 3, 1, 6, 4]\n" + "```\n" + "\n" + ". . .\n" + "\n" + "To achieve the desired result:\n" + "\n" + "```python\n" + "[x * 2 for x in nums]\n" + "```\n" + "\n" + "```\n" + "[6, 2, 12, 8]\n" + "```\n" + "\n" + ". . .\n" + "\n" + "Or\n" + "\n" + "```python\n" + "y = []\n" + "for x in nums:\n" + "    y.append(x * 2)\n" + "y\n" + "```\n" + "\n" + "```\n" + "[6, 2, 12, 8]\n" + "```\n" + "\n" + "## Vectorization\n" + "\n" + "```{r}\n" + "library(dplyr)\n" + "\n" + "penguins |>\n" + "  mutate(bill_ratio = bill_len / bill_dep)\n" + "```\n" + "\n" + "\n" + "## Iteration in R\n" + "\n" + "We also have:\n" + "\n" + "-   `group_by()` with `summarize()` *(for every group, do this summary)*\n" + "\n" + "-   `ggplot2::facet_wrap()` *(for every level of a factor, make a plot)*\n" + "\n" + "-   `*apply()` and `purrr::map*()` and *(for every element of a list/vector, do this function)*\n" + "\n" + "\n" + "## Why iteration?\n" + "\n" + "Doing the same operation multiple times:\n" + "\n" + "- Process multiple files\n" + "- Analyze data from multiple sites\n" + "- Apply the same transformation to multiple columns\n" + "- Run simulations\n" + "\n" + ". . .\n" + "\n" + "**Goal**: Write code that is:\n" + "\n" + "- Less repetitive\n" + "- Easier to maintain\n" + "- Harder to make mistakes in\n" + "\n" + "# Loops\n" + "\n" + "## Basic `for` loop syntax\n" + "\n" + "```{r}\n" + "#| eval: false\n" + "for (item in vector_or_list) {\n" + "  # item takes on each value in vector\n" + "  # Do something with item\n" + "}\n" + "```\n" + "\n" + "<br>\n" + "\n" + ". . .\n" + "\n" + "\n" + "```{r}\n" + "parks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n" + "\n" + "for (park in parks) {\n" + "  print(paste(\"Processing\", park))\n" + "}\n" + "```\n" + "\n" + "## Loop over values vs indices\n" + "\n" + "**Loop over values** when you only need the *value* of each element.\n" + "\n" + "```{r}\n" + "parks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n" + "\n" + "for (park in parks) {\n" + "  print(paste(\"Processing\", park))\n" + "}\n" + "```\n" + "\n" + ". . .\n" + "\n" + "**Loop over indices** when you need to know the *position*.\n" + "\n" + "## When to use indices\n" + "\n" + "Use `seq_along()`, `seq_len()`, `seq()` when you need to:\n" + "\n" + "1. **Access the same position in multiple objects**:\n" + "```{r}\n" + "parks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n" + "provinces <- c(\"Alberta\", \"Alberta\", \"British Columbia\", \"Manitoba\")\n" + "\n" + "for (i in seq_along(parks)) {\n" + "  print(paste(parks[i], \"is in\", provinces[i]))\n" + "}\n" + "```\n" + "\n" + ". . . \n" + "\n" + "2. **Store results at specific positions**:\n" + "```{r}\n" + "#| eval: false\n" + "results <- vector(\"list\", length(files))\n" + "\n" + "for (i in seq_along(files)) {\n" + "  results[[i]] <- read_csv(files[i])\n" + "}\n" + "```\n" + "\n" + "\n" + "## Example: Reading multiple files\n" + "\n" + "```{r}\n" + "#| eval: false\n" + "library(readr)\n" + "library(dplyr)\n" + "\n" + "files <- list.files(\"data/\", pattern = \"\\.csv$\", full.names = TRUE)\n" + "\n" + "data_list <- vector(mode = \"list\", length = length(files))\n" + "\n" + "for (i in seq_along(files)) {\n" + "  data_list[[i]] <- read_csv(files[i])\n" + "}\n" + "\n" + "# Combine into one data frame\n" + "all_data <- rbind_list(data_list)\n" + "```\n" + "\n" + "## Your Turn: Create a `for` loop to make and save plots for each rodent site (plot)\n" + "\n" + "Starting code in `04-iteration.R`\n" + "\n" + "<br>\n" + "\n" + "```{r}\n" + "#| eval: false\n" + "rodents <- read_csv(\"PortalData/Rodents/Portal_rodent.csv\")\n" + "\n" + "rodent_counts <- rodents |>\n" + "  filter(species == \"DM\") |>\n" + "  group_by(year, plot) |>\n" + "  summarise(n = n()) |>\n" + "  ungroup()\n" + "```\n" + "\n" + "\n" + "\n" + "## `while` loops\n" + "\n" + "- Loop continues *while* the condition is `TRUE`\n" + "- Stops when the condition is `FALSE`.\n" + "\n" + "::: columns\n" + "::: {.column width=\"50%\"}\n" + "\n" + "```{r}\n" + "#| eval: false\n" + "while (condition_is_true) {\n" + "  # Do something\n" + "}\n" + "```\n" + "\n" + ":::\n" + "\n" + "::: {.column width=\"50%\"}\n" + "::: fragment\n" + "\n" + "```{r}\n" + "i <- 1\n" + "while (i < 6) {\n" + "  print(i)\n" + "  i <- i + 1\n" + "}\n" + "```\n" + "\n" + ":::\n" + ":::\n" + ":::\n" + "\n" + ". . . \n" + "\n" + "Use when you don't know in advance how many iterations you'll need.\n" + "\n" + ". . . \n" + "\n" + "Usually need to advance the iterator inside the loop.\n" + "\n" + "## While loop example: Simulation\n" + "\n" + "```{r}\n" + "# Simulate until estimate stabilizes\n" + "estimate <- 0\n" + "previous <- Inf\n" + "tolerance <- 0.001\n" + "n <- 100\n" + "reps <- 0\n" + "\n" + "while (abs(estimate - previous) > tolerance) {\n" + "  previous <- estimate\n" + "  sample_data <- rnorm(n, mean = 5, sd = 2)\n" + "  estimate <- mean(sample_data)\n" + "  n <- n + 100\n" + "  reps <- reps + 1\n" + "}\n" + "n\n" + "reps\n" + "```\n" + "\n" + "::: {.notes}\n" + "This code simulates data repeatedly until the estimated mean stabilizes within a tolerance threshold:\n" + "\n" + "Initialize: Start with an estimate of 0, track the previous estimate, set a tolerance of 0.001, and begin with sample size 100\n" + "\n" + "Loop: Continue while the change in estimate exceeds the tolerance\n" + "\n" + "Save current estimate as previous\n" + "Generate random normal data (mean=5, sd=2) with current sample size\n" + "Calculate new estimate (mean of sample)\n" + "Increase sample size by 100\n" + "Result: Stops when consecutive estimates differ by less than 0.001\n" + "\n" + "This demonstrates the law of large numbers - as sample size increases, the sample mean converges to the true population mean (5). The loop automatically determines how many observations are needed for the estimate to stabilize.\n" + ":::\n" + "\n" + "Rarely needed in data analysis work.\n" + "\n" + "# Iterating with `{purrr}`\n" + "\n" + "## Functional programming\n" + "\n" + "\"functional programming\" because functions take other functions as input\n" + "\n" + "-   modifying multiple columns `dplyr::across()`\n" + "\n" + "-   reading multiple files `purrr::map()` and friends\n" + "\n" + "-   saving multiple outputs `purrr::walk()`\n" + "\n" + "## Why `purrr`?\n" + "\n" + "The `purrr` package provides tools for functional programming:\n" + "\n" + "- Clearer intent than loops\n" + "- Less boilerplate code\n" + "- Type-safe variants\n" + "- Works seamlessly with pipes\n" + "\n" + "## Fundamental paradigms\n" + "\n" + "Functional programming has three fundamental paradigms; they act on lists or vectors:\n" + "\n" + "::: incremental\n" + "-   `map` - do *this* to each element: `purrr::map()`\n" + "-   `filter` - like spaghetti, not coffee: `purrr::keep()`\n" + "-   `reduce` - combine into new thing: `purrr::reduce()`\n" + ":::\n" + "\n" + ". . .\n" + "\n" + "Each of these takes a *function* as an argument, to tell the operator *what* to do.\n" + "\n" + ". . . \n" + "\n" + "We are going to focus on `map()` and friends.\n" + "\n" + "## `map()`: Apply a function to each element\n" + "\n" + "```{r}\n" + "parks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n" + "```\n" + "\n" + "<br>\n" + "\n" + "::: {.columns}\n" + "::: {.column width=\"50%\"}\n" + "\n" + "::: fragment\n" + "\n" + "### `for` loop:\n" + "\n" + "```{r}\n" + "for (park in parks) {\n" + "  print(nchar(park))\n" + "}\n" + "```\n" + "\n" + ":::\n" + ":::\n" + "::: {.column width=\"50%\"}\n" + "\n" + "::: fragment\n" + "### `map()`\n" + "\n" + "`map(.x, .f)` applies function `.f` to each element of `.x`\n" + "\n" + "```{r}\n" + "map(parks, nchar)\n" + "```\n" + "\n" + "::: fragment\n" + "\n" + "Returns a **list** by default.\n" + "\n" + ":::\n" + ":::\n" + ":::\n" + ":::\n" + "\n" + "## Aside: Review of lists\n" + "\n" + "Lists are like vectors, but instead of each element being a single value, each \n" + "element can be a more complex object (vector, data-frame, function, etc.)\n" + "\n" + "Lists can have `names`\n" + "\n" + "::: columns\n" + "::: {.column width=\"50%\"}\n" + "\n" + "```{r}\n" + "my_list <- list(\n" + "  c(1, 2, 3),\n" + "  c(\"a\", \"b\", \"c\"),\n" + "  data.frame(x = 1:3, y = c(\"A\", \"B\", \"C\"))\n" + ")\n" + "my_list\n" + "```\n" + "\n" + ":::\n" + "::: {.column width=\"50%\"}\n" + "\n" + "```{r}\n" + "my_named_list <- list(\n" + "  numbers = c(1, 2, 3),\n" + "  letters = c(\"a\", \"b\", \"c\"),\n" + "  df = data.frame(x = 1:3, y = c(\"A\", \"B\", \"C\"))\n" + ")\n" + "my_named_list\n" + "names(my_named_list)\n" + "```\n" + "\n" + ":::\n" + ":::\n" + "\n" + "::: {.notes}\n" + "Let's make and explore this object in R\n" + ":::\n" + "\n" + "## Type-specific map variants\n" + "\n" + "`map_*()` functions return ***atomic* vectors** of specific types:\n" + "\n" + "- `map_dbl()` → numeric vector\n" + "- `map_chr()` → character vector\n" + "- `map_int()` → integer vector\n" + "- `map_lgl()` → logical vector\n" + "\n" + "## Type-specific map variants\n" + "\n" + "```{r}\n" + "map_dbl(parks, nchar)\n" + "```\n" + "\n" + ". . .\n" + "\n" + "```{r}\n" + "map_chr(parks, toupper)\n" + "```\n" + "\n" + "<br>\n" + "\n" + ". . .\n" + "\n" + "**Note:** These are simple examples to illustrate, but `nchar()` and `toupper()` are already vectorized, so you wouldn't normally use `map()` for them.\n" + "\n" + "<br>\n" + "\n" + ". . .\n" + "\n" + "```{r}\n" + "nchar(parks)\n" + "toupper(parks)\n" + "```\n" + "\n" + "## Anonymous functions\n" + "\n" + "```r\n" + "map(.x, .f)\n" + "```\n" + "\n" + "The `.f` argument to `map()` can be:\n" + "\n" + "-   a named function (e.g., `nchar`, `toupper`)\n" + "-   an anonymous function (a function defined *in place*)\n" + "\n" + "## Syntax for anonymous functions:\n" + "\n" + "::: {.columns}\n" + "::: {.column}\n" + "\n" + "If simple, on one line:\n" + "\n" + "``` r\n" + "\(x) what to do with x\n" + "```\n" + "\n" + "<br>\n" + "\n" + "::: {.fragment}\n" + "\n" + "```{r}\n" + "num <- 1:4\n" + "map(num, \(x) x + 1)\n" + "```\n" + "\n" + ":::\n" + ":::\n" + "::: {.column}\n" + "\n" + "::: {.fragment}\n" + "\n" + "Or more complex:\n" + "\n" + "``` r\n" + "\(arg1, arg2, ...) {\n" + "  # function body\n" + "}\n" + "```\n" + "\n" + ":::\n" + "\n" + "<br>\n" + "\n" + "::: {.fragment}\n" + "\n" + "```{r}\n" + "num <- 1:4\n" + "map(num, \(x) {\n" + "  y <- x^2\n" + "  z <- y + 3\n" + "  z\n" + "})\n" + "```\n" + "\n" + ":::\n" + ":::\n" + ":::\n" + "\n" + "## Map: Atomic variants\n" + "\n" + "::::: columns\n" + "::: {.column width=\"50%\"}\n" + "`map()` always returns a list:\n" + "\n" + "```{r}\n" + "num <- 1:4\n" + "map(num, \(x) x + 1)\n" + "```\n" + "\n" + ":::\n" + "\n" + "::: {.column width=\"50%\"}\n" + "Use an atomic variant to specify type:\n" + "\n" + "```{r}\n" + "num <- 1:4\n" + "map_int(num, \(x) x + 1)\n" + "```\n" + "\n" + ":::\n" + ":::::\n" + "\n" + "## Reading multiple files\n" + "\n" + "Iteration functions in {purrr} can help with repetitive tasks.\n" + "\n" + ". . .\n" + "\n" + "### Example\n" + "\n" + "Read Excel files from a directory, then combine into a single data-frame.\n" + "\n" + "## Our turn: Reading data manually\n" + "\n" + "Here's our starting code:\n" + "\n" + "``` r\n" + "data1952 <- read_excel(\"data/gapminder/1952.xlsx\")\n" + "data1957 <- read_excel(\"data/gapminder/1957.xlsx\")\n" + "data1962 <- read_excel(\"data/gapminder/1952.xlsx\")\n" + "data1967 <- read_excel(\"data/gapminder/1967.xlsx\")\n" + "\n" + "data_manual <- bind_rows(data1952, data1957, data1962, data1967)\n" + "```\n" + "\n" + ". . .\n" + "\n" + "What problems do you see?\n" + "\n" + "(I see one real problem, and one philosophical problem)\n" + "\n" + "<br>\n" + "\n" + ". . .\n" + "\n" + "Starting code in `04-iteration.R`\n" + "\n" + "## Our turn: Make list of paths\n" + "\n" + "I see this as a two step problem:\n" + "\n" + "::: incremental\n" + "-   make a named list of paths, name is year\n" + "-   use list of paths to read data frames, combine\n" + ":::\n" + "\n" + ". . .\n" + "\n" + "Let's work together to improve this code to get paths:\n" + "\n" + "``` r\n" + "paths <-\n" + "  # get the filepaths from the directory\n" + "  fs::dir_ls(\"data/gapminder\") |>\n" + "  # extract the year as names\n" + "```\n" + "\n" + "## Our turn: Read data\n" + "\n" + "Let's work together to improve this code to read data:\n" + "\n" + "``` r\n" + "data <-\n" + "  paths |>\n" + "  # read each file from excel, into data frame\n" + "  # set list-names as column `year`\n" + "  # bind into single data-frame\n" + "  # convert year to number\n" + "```\n" + "\n" + "## Map over two inputs\n" + "\n" + "Sometimes you need to map over two inputs that are the same length.\n" + "\n" + "Use `map2()` with two inputs, and supply a function that takes two arguments.\n" + "\n" + "```{r}\n" + "params1 <- c(1, 2, 3)\n" + "params2 <- c(10, 20, 30)\n" + "\n" + "map2(\n" + "  params1,\n" + "  params2,\n" + "  \(x, y) x + y\n" + ")\n" + "```\n" + "\n" + ". . .\n" + "\n" + "**Vector variants:** `map2_dbl()`, `map2_chr()`, etc.\n" + "\n" + "**See `pmap()` for more than two inputs.**\n" + "\n" + "## `purrr::walk()`\n" + "\n" + "For functions called for their *side effects* (i.e., not for their return value)\n" + "\n" + "Useful for:\n" + "\n" + "- writing data files\n" + "- saving plots\n" + "- `walk2()` for two inputs\n" + "\n" + ". . . \n" + "\n" + "```{r}\n" + "#| eval: false\n" + "walk2(\n" + "  list_of_dataframes,\n" + "  list_of_filepaths,\n" + "  \(df, f) {\n" + "    write_csv(df, f)\n" + "  }\n" + ")\n" + "```\n" + "\n" + "## Your turn\n" + "\n" + "Using our first example with the rodent data, use `purrr` instead of a `for`\n" + "loop to:\n" + "\n" + "1. Make a list of plots\n" + "2. Save plots for each rodent site (plot)\n" + "\n" + "<br>\n" + "\n" + ". . .\n" + "\n" + "Starting code in `04-iteration.R`\n" + "\n" + "## Summary\n" + "\n" + "- **Loops** are explicit but verbose\n" + "- **Functional programming** (`purrr`) is usually clearer and efficient\n" + "- Use `map_*()` to iterate over lists/vectors\n" + "- Use `walk()` (and variants) for side effects\n" + "- `purrr` functions can be parallelized with `in_parallel()`\n" + "\n" + "## Resources\n" + "\n" + "- R4DS chapter on iteration: <https://r4ds.hadley.nz/iteration>\n" + "- purrr documentation: <https://purrr.tidyverse.org/>\n" + "- tidyverse blog on purrr: <https://tidyverse.org/blog/2023/05/purrr-walk-this-way/>\n" + "- Parallel processing with purrr: <https://purrr.tidyverse.org/articles/parallel.html>\n" + "\n" + "## Another example\n" + "\n" + "See <https://github.com/ateucher/pc-programming/blob/main/solutions/07-advanced-iteration.qmd>\n" + "for an example of using `purrr` to conduct a power analysis on rodent data in Quarto. It \n" + "includes a section on running it in parallel.\n" + "\n" + "The rendered report is at <https://github.com/ateucher/pc-programming/blob/main/solutions/07-advanced-iteration.pdf>\n" + ""</script>
<script> window._input_filename = '/home/runner/work/pc-intermediate-r/pc-intermediate-r/programming-iteration.qmd'</script>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="./index.html"><i class="fa-solid fa-house" aria-label="house"></i></a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/revealeditable/editable.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, Revealeditable, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/ateucher\.github\.io\/pc-intermediate-r\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>