{
  "hash": "1749d1a0b261e9e6ed07370ff5379e06",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Programming with R: Iteration\"\nsubtitle: \"Parks Canada; Ecological Integrity Monitoring Program\"\nauthor: \"Andy Teucher\"\nformat: revealjs\nknitr:\n  opts_chunk: \n    R.options:\n      width: 110\n      pillar.print_max: 5\n      pillar.print_min: 5\n    echo: true\n---\n\n## Learning Objectives\n\nAt the end of this section you will be able to:\n\n::: {style=\"font-size: 80%;\"}\n\n- recognise that much iteration comes free with R\n- understand fundamentals of loops\n- use `purrr` functions for elegant iteration\n- understand functional programming and use anonymous functions with `purrr`\n\n\n\n:::\n\n## What is iteration?\n\n-   Iteration means repeating steps multiple times until a condition is\n    met\n\n-   In other languages, iteration is performed with loops: `for`, `while`\n\n. . .\n\n-   Iteration is different in R\n\n-   You *can* use loops....... but you often don't *need* to\n\n## Iteration in R\n\nIteration is an inherent part of the **`R`** language. For example, if\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnums <- c(3, 1, 6, 4)\n```\n:::\n\n\nThen\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\n2 * nums\n```\n:::\n\n\nis\n\n. . .\n\n```\n[1]  6  2 12  8\n```\n\nand NOT\n\n. . .\n\n```\n[1] 3 1 6 4 3 1 6 4\n```\n\n. . .\n\n**This is called vectorization** - operations are automatically applied to each element of a vector.\n\n::: {.notes}\nWe take this for granted in R, but in most other programming languages, you would need to write a loop to achieve the same result. For example, in Python, you would typically use a list comprehension or a for loop to multiply each element of a list by 2. R's vectorized operations make code more concise and often faster.\n:::\n\n## Meanwhile with `python`\n\n```python\nnums = [3,1,6,4]\n\nnums * 2\n```\n\n```\n[3, 1, 6, 4, 3, 1, 6, 4]\n```\n\n. . .\n\nTo achieve the desired result:\n\n```python\n[x * 2 for x in nums]\n```\n\n```\n[6, 2, 12, 8]\n```\n\n. . .\n\nOr\n\n```python\ny = []\nfor x in nums:\n    y.append(x * 2)\ny\n```\n\n```\n[6, 2, 12, 8]\n```\n\n## Vectorization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\npenguins |>\n  mutate(bill_ratio = bill_len / bill_dep)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      species    island bill_len bill_dep flipper_len body_mass    sex year bill_ratio\n1      Adelie Torgersen     39.1     18.7         181      3750   male 2007   2.090909\n2      Adelie Torgersen     39.5     17.4         186      3800 female 2007   2.270115\n3      Adelie Torgersen     40.3     18.0         195      3250 female 2007   2.238889\n4      Adelie Torgersen       NA       NA          NA        NA   <NA> 2007         NA\n5      Adelie Torgersen     36.7     19.3         193      3450 female 2007   1.901554\n6      Adelie Torgersen     39.3     20.6         190      3650   male 2007   1.907767\n7      Adelie Torgersen     38.9     17.8         181      3625 female 2007   2.185393\n8      Adelie Torgersen     39.2     19.6         195      4675   male 2007   2.000000\n9      Adelie Torgersen     34.1     18.1         193      3475   <NA> 2007   1.883978\n10     Adelie Torgersen     42.0     20.2         190      4250   <NA> 2007   2.079208\n11     Adelie Torgersen     37.8     17.1         186      3300   <NA> 2007   2.210526\n12     Adelie Torgersen     37.8     17.3         180      3700   <NA> 2007   2.184971\n13     Adelie Torgersen     41.1     17.6         182      3200 female 2007   2.335227\n14     Adelie Torgersen     38.6     21.2         191      3800   male 2007   1.820755\n15     Adelie Torgersen     34.6     21.1         198      4400   male 2007   1.639810\n16     Adelie Torgersen     36.6     17.8         185      3700 female 2007   2.056180\n17     Adelie Torgersen     38.7     19.0         195      3450 female 2007   2.036842\n18     Adelie Torgersen     42.5     20.7         197      4500   male 2007   2.053140\n19     Adelie Torgersen     34.4     18.4         184      3325 female 2007   1.869565\n20     Adelie Torgersen     46.0     21.5         194      4200   male 2007   2.139535\n21     Adelie    Biscoe     37.8     18.3         174      3400 female 2007   2.065574\n22     Adelie    Biscoe     37.7     18.7         180      3600   male 2007   2.016043\n23     Adelie    Biscoe     35.9     19.2         189      3800 female 2007   1.869792\n24     Adelie    Biscoe     38.2     18.1         185      3950   male 2007   2.110497\n25     Adelie    Biscoe     38.8     17.2         180      3800   male 2007   2.255814\n26     Adelie    Biscoe     35.3     18.9         187      3800 female 2007   1.867725\n27     Adelie    Biscoe     40.6     18.6         183      3550   male 2007   2.182796\n28     Adelie    Biscoe     40.5     17.9         187      3200 female 2007   2.262570\n29     Adelie    Biscoe     37.9     18.6         172      3150 female 2007   2.037634\n30     Adelie    Biscoe     40.5     18.9         180      3950   male 2007   2.142857\n31     Adelie     Dream     39.5     16.7         178      3250 female 2007   2.365269\n32     Adelie     Dream     37.2     18.1         178      3900   male 2007   2.055249\n33     Adelie     Dream     39.5     17.8         188      3300 female 2007   2.219101\n34     Adelie     Dream     40.9     18.9         184      3900   male 2007   2.164021\n35     Adelie     Dream     36.4     17.0         195      3325 female 2007   2.141176\n36     Adelie     Dream     39.2     21.1         196      4150   male 2007   1.857820\n37     Adelie     Dream     38.8     20.0         190      3950   male 2007   1.940000\n38     Adelie     Dream     42.2     18.5         180      3550 female 2007   2.281081\n39     Adelie     Dream     37.6     19.3         181      3300 female 2007   1.948187\n40     Adelie     Dream     39.8     19.1         184      4650   male 2007   2.083770\n41     Adelie     Dream     36.5     18.0         182      3150 female 2007   2.027778\n42     Adelie     Dream     40.8     18.4         195      3900   male 2007   2.217391\n43     Adelie     Dream     36.0     18.5         186      3100 female 2007   1.945946\n44     Adelie     Dream     44.1     19.7         196      4400   male 2007   2.238579\n45     Adelie     Dream     37.0     16.9         185      3000 female 2007   2.189349\n46     Adelie     Dream     39.6     18.8         190      4600   male 2007   2.106383\n47     Adelie     Dream     41.1     19.0         182      3425   male 2007   2.163158\n48     Adelie     Dream     37.5     18.9         179      2975   <NA> 2007   1.984127\n49     Adelie     Dream     36.0     17.9         190      3450 female 2007   2.011173\n50     Adelie     Dream     42.3     21.2         191      4150   male 2007   1.995283\n51     Adelie    Biscoe     39.6     17.7         186      3500 female 2008   2.237288\n52     Adelie    Biscoe     40.1     18.9         188      4300   male 2008   2.121693\n53     Adelie    Biscoe     35.0     17.9         190      3450 female 2008   1.955307\n54     Adelie    Biscoe     42.0     19.5         200      4050   male 2008   2.153846\n55     Adelie    Biscoe     34.5     18.1         187      2900 female 2008   1.906077\n56     Adelie    Biscoe     41.4     18.6         191      3700   male 2008   2.225806\n57     Adelie    Biscoe     39.0     17.5         186      3550 female 2008   2.228571\n58     Adelie    Biscoe     40.6     18.8         193      3800   male 2008   2.159574\n59     Adelie    Biscoe     36.5     16.6         181      2850 female 2008   2.198795\n60     Adelie    Biscoe     37.6     19.1         194      3750   male 2008   1.968586\n61     Adelie    Biscoe     35.7     16.9         185      3150 female 2008   2.112426\n62     Adelie    Biscoe     41.3     21.1         195      4400   male 2008   1.957346\n63     Adelie    Biscoe     37.6     17.0         185      3600 female 2008   2.211765\n64     Adelie    Biscoe     41.1     18.2         192      4050   male 2008   2.258242\n65     Adelie    Biscoe     36.4     17.1         184      2850 female 2008   2.128655\n66     Adelie    Biscoe     41.6     18.0         192      3950   male 2008   2.311111\n67     Adelie    Biscoe     35.5     16.2         195      3350 female 2008   2.191358\n68     Adelie    Biscoe     41.1     19.1         188      4100   male 2008   2.151832\n69     Adelie Torgersen     35.9     16.6         190      3050 female 2008   2.162651\n70     Adelie Torgersen     41.8     19.4         198      4450   male 2008   2.154639\n71     Adelie Torgersen     33.5     19.0         190      3600 female 2008   1.763158\n72     Adelie Torgersen     39.7     18.4         190      3900   male 2008   2.157609\n73     Adelie Torgersen     39.6     17.2         196      3550 female 2008   2.302326\n74     Adelie Torgersen     45.8     18.9         197      4150   male 2008   2.423280\n75     Adelie Torgersen     35.5     17.5         190      3700 female 2008   2.028571\n76     Adelie Torgersen     42.8     18.5         195      4250   male 2008   2.313514\n77     Adelie Torgersen     40.9     16.8         191      3700 female 2008   2.434524\n78     Adelie Torgersen     37.2     19.4         184      3900   male 2008   1.917526\n79     Adelie Torgersen     36.2     16.1         187      3550 female 2008   2.248447\n80     Adelie Torgersen     42.1     19.1         195      4000   male 2008   2.204188\n81     Adelie Torgersen     34.6     17.2         189      3200 female 2008   2.011628\n82     Adelie Torgersen     42.9     17.6         196      4700   male 2008   2.437500\n83     Adelie Torgersen     36.7     18.8         187      3800 female 2008   1.952128\n84     Adelie Torgersen     35.1     19.4         193      4200   male 2008   1.809278\n85     Adelie     Dream     37.3     17.8         191      3350 female 2008   2.095506\n86     Adelie     Dream     41.3     20.3         194      3550   male 2008   2.034483\n87     Adelie     Dream     36.3     19.5         190      3800   male 2008   1.861538\n88     Adelie     Dream     36.9     18.6         189      3500 female 2008   1.983871\n89     Adelie     Dream     38.3     19.2         189      3950   male 2008   1.994792\n90     Adelie     Dream     38.9     18.8         190      3600 female 2008   2.069149\n91     Adelie     Dream     35.7     18.0         202      3550 female 2008   1.983333\n92     Adelie     Dream     41.1     18.1         205      4300   male 2008   2.270718\n93     Adelie     Dream     34.0     17.1         185      3400 female 2008   1.988304\n94     Adelie     Dream     39.6     18.1         186      4450   male 2008   2.187845\n95     Adelie     Dream     36.2     17.3         187      3300 female 2008   2.092486\n96     Adelie     Dream     40.8     18.9         208      4300   male 2008   2.158730\n97     Adelie     Dream     38.1     18.6         190      3700 female 2008   2.048387\n98     Adelie     Dream     40.3     18.5         196      4350   male 2008   2.178378\n99     Adelie     Dream     33.1     16.1         178      2900 female 2008   2.055901\n100    Adelie     Dream     43.2     18.5         192      4100   male 2008   2.335135\n101    Adelie    Biscoe     35.0     17.9         192      3725 female 2009   1.955307\n102    Adelie    Biscoe     41.0     20.0         203      4725   male 2009   2.050000\n103    Adelie    Biscoe     37.7     16.0         183      3075 female 2009   2.356250\n104    Adelie    Biscoe     37.8     20.0         190      4250   male 2009   1.890000\n105    Adelie    Biscoe     37.9     18.6         193      2925 female 2009   2.037634\n106    Adelie    Biscoe     39.7     18.9         184      3550   male 2009   2.100529\n107    Adelie    Biscoe     38.6     17.2         199      3750 female 2009   2.244186\n108    Adelie    Biscoe     38.2     20.0         190      3900   male 2009   1.910000\n109    Adelie    Biscoe     38.1     17.0         181      3175 female 2009   2.241176\n110    Adelie    Biscoe     43.2     19.0         197      4775   male 2009   2.273684\n111    Adelie    Biscoe     38.1     16.5         198      3825 female 2009   2.309091\n112    Adelie    Biscoe     45.6     20.3         191      4600   male 2009   2.246305\n113    Adelie    Biscoe     39.7     17.7         193      3200 female 2009   2.242938\n114    Adelie    Biscoe     42.2     19.5         197      4275   male 2009   2.164103\n115    Adelie    Biscoe     39.6     20.7         191      3900 female 2009   1.913043\n116    Adelie    Biscoe     42.7     18.3         196      4075   male 2009   2.333333\n117    Adelie Torgersen     38.6     17.0         188      2900 female 2009   2.270588\n118    Adelie Torgersen     37.3     20.5         199      3775   male 2009   1.819512\n119    Adelie Torgersen     35.7     17.0         189      3350 female 2009   2.100000\n120    Adelie Torgersen     41.1     18.6         189      3325   male 2009   2.209677\n121    Adelie Torgersen     36.2     17.2         187      3150 female 2009   2.104651\n122    Adelie Torgersen     37.7     19.8         198      3500   male 2009   1.904040\n123    Adelie Torgersen     40.2     17.0         176      3450 female 2009   2.364706\n124    Adelie Torgersen     41.4     18.5         202      3875   male 2009   2.237838\n125    Adelie Torgersen     35.2     15.9         186      3050 female 2009   2.213836\n126    Adelie Torgersen     40.6     19.0         199      4000   male 2009   2.136842\n127    Adelie Torgersen     38.8     17.6         191      3275 female 2009   2.204545\n128    Adelie Torgersen     41.5     18.3         195      4300   male 2009   2.267760\n129    Adelie Torgersen     39.0     17.1         191      3050 female 2009   2.280702\n130    Adelie Torgersen     44.1     18.0         210      4000   male 2009   2.450000\n131    Adelie Torgersen     38.5     17.9         190      3325 female 2009   2.150838\n132    Adelie Torgersen     43.1     19.2         197      3500   male 2009   2.244792\n133    Adelie     Dream     36.8     18.5         193      3500 female 2009   1.989189\n134    Adelie     Dream     37.5     18.5         199      4475   male 2009   2.027027\n135    Adelie     Dream     38.1     17.6         187      3425 female 2009   2.164773\n136    Adelie     Dream     41.1     17.5         190      3900   male 2009   2.348571\n137    Adelie     Dream     35.6     17.5         191      3175 female 2009   2.034286\n138    Adelie     Dream     40.2     20.1         200      3975   male 2009   2.000000\n139    Adelie     Dream     37.0     16.5         185      3400 female 2009   2.242424\n140    Adelie     Dream     39.7     17.9         193      4250   male 2009   2.217877\n141    Adelie     Dream     40.2     17.1         193      3400 female 2009   2.350877\n142    Adelie     Dream     40.6     17.2         187      3475   male 2009   2.360465\n143    Adelie     Dream     32.1     15.5         188      3050 female 2009   2.070968\n144    Adelie     Dream     40.7     17.0         190      3725   male 2009   2.394118\n145    Adelie     Dream     37.3     16.8         192      3000 female 2009   2.220238\n146    Adelie     Dream     39.0     18.7         185      3650   male 2009   2.085561\n147    Adelie     Dream     39.2     18.6         190      4250   male 2009   2.107527\n148    Adelie     Dream     36.6     18.4         184      3475 female 2009   1.989130\n149    Adelie     Dream     36.0     17.8         195      3450 female 2009   2.022472\n150    Adelie     Dream     37.8     18.1         193      3750   male 2009   2.088398\n151    Adelie     Dream     36.0     17.1         187      3700 female 2009   2.105263\n152    Adelie     Dream     41.5     18.5         201      4000   male 2009   2.243243\n153    Gentoo    Biscoe     46.1     13.2         211      4500 female 2007   3.492424\n154    Gentoo    Biscoe     50.0     16.3         230      5700   male 2007   3.067485\n155    Gentoo    Biscoe     48.7     14.1         210      4450 female 2007   3.453901\n156    Gentoo    Biscoe     50.0     15.2         218      5700   male 2007   3.289474\n157    Gentoo    Biscoe     47.6     14.5         215      5400   male 2007   3.282759\n158    Gentoo    Biscoe     46.5     13.5         210      4550 female 2007   3.444444\n159    Gentoo    Biscoe     45.4     14.6         211      4800 female 2007   3.109589\n160    Gentoo    Biscoe     46.7     15.3         219      5200   male 2007   3.052288\n161    Gentoo    Biscoe     43.3     13.4         209      4400 female 2007   3.231343\n162    Gentoo    Biscoe     46.8     15.4         215      5150   male 2007   3.038961\n163    Gentoo    Biscoe     40.9     13.7         214      4650 female 2007   2.985401\n164    Gentoo    Biscoe     49.0     16.1         216      5550   male 2007   3.043478\n165    Gentoo    Biscoe     45.5     13.7         214      4650 female 2007   3.321168\n166    Gentoo    Biscoe     48.4     14.6         213      5850   male 2007   3.315068\n167    Gentoo    Biscoe     45.8     14.6         210      4200 female 2007   3.136986\n168    Gentoo    Biscoe     49.3     15.7         217      5850   male 2007   3.140127\n169    Gentoo    Biscoe     42.0     13.5         210      4150 female 2007   3.111111\n170    Gentoo    Biscoe     49.2     15.2         221      6300   male 2007   3.236842\n171    Gentoo    Biscoe     46.2     14.5         209      4800 female 2007   3.186207\n172    Gentoo    Biscoe     48.7     15.1         222      5350   male 2007   3.225166\n173    Gentoo    Biscoe     50.2     14.3         218      5700   male 2007   3.510490\n174    Gentoo    Biscoe     45.1     14.5         215      5000 female 2007   3.110345\n175    Gentoo    Biscoe     46.5     14.5         213      4400 female 2007   3.206897\n176    Gentoo    Biscoe     46.3     15.8         215      5050   male 2007   2.930380\n177    Gentoo    Biscoe     42.9     13.1         215      5000 female 2007   3.274809\n178    Gentoo    Biscoe     46.1     15.1         215      5100   male 2007   3.052980\n179    Gentoo    Biscoe     44.5     14.3         216      4100   <NA> 2007   3.111888\n180    Gentoo    Biscoe     47.8     15.0         215      5650   male 2007   3.186667\n181    Gentoo    Biscoe     48.2     14.3         210      4600 female 2007   3.370629\n182    Gentoo    Biscoe     50.0     15.3         220      5550   male 2007   3.267974\n183    Gentoo    Biscoe     47.3     15.3         222      5250   male 2007   3.091503\n184    Gentoo    Biscoe     42.8     14.2         209      4700 female 2007   3.014085\n185    Gentoo    Biscoe     45.1     14.5         207      5050 female 2007   3.110345\n186    Gentoo    Biscoe     59.6     17.0         230      6050   male 2007   3.505882\n187    Gentoo    Biscoe     49.1     14.8         220      5150 female 2008   3.317568\n188    Gentoo    Biscoe     48.4     16.3         220      5400   male 2008   2.969325\n189    Gentoo    Biscoe     42.6     13.7         213      4950 female 2008   3.109489\n190    Gentoo    Biscoe     44.4     17.3         219      5250   male 2008   2.566474\n191    Gentoo    Biscoe     44.0     13.6         208      4350 female 2008   3.235294\n192    Gentoo    Biscoe     48.7     15.7         208      5350   male 2008   3.101911\n193    Gentoo    Biscoe     42.7     13.7         208      3950 female 2008   3.116788\n194    Gentoo    Biscoe     49.6     16.0         225      5700   male 2008   3.100000\n195    Gentoo    Biscoe     45.3     13.7         210      4300 female 2008   3.306569\n196    Gentoo    Biscoe     49.6     15.0         216      4750   male 2008   3.306667\n197    Gentoo    Biscoe     50.5     15.9         222      5550   male 2008   3.176101\n198    Gentoo    Biscoe     43.6     13.9         217      4900 female 2008   3.136691\n199    Gentoo    Biscoe     45.5     13.9         210      4200 female 2008   3.273381\n200    Gentoo    Biscoe     50.5     15.9         225      5400   male 2008   3.176101\n201    Gentoo    Biscoe     44.9     13.3         213      5100 female 2008   3.375940\n202    Gentoo    Biscoe     45.2     15.8         215      5300   male 2008   2.860759\n203    Gentoo    Biscoe     46.6     14.2         210      4850 female 2008   3.281690\n204    Gentoo    Biscoe     48.5     14.1         220      5300   male 2008   3.439716\n205    Gentoo    Biscoe     45.1     14.4         210      4400 female 2008   3.131944\n206    Gentoo    Biscoe     50.1     15.0         225      5000   male 2008   3.340000\n207    Gentoo    Biscoe     46.5     14.4         217      4900 female 2008   3.229167\n208    Gentoo    Biscoe     45.0     15.4         220      5050   male 2008   2.922078\n209    Gentoo    Biscoe     43.8     13.9         208      4300 female 2008   3.151079\n210    Gentoo    Biscoe     45.5     15.0         220      5000   male 2008   3.033333\n211    Gentoo    Biscoe     43.2     14.5         208      4450 female 2008   2.979310\n212    Gentoo    Biscoe     50.4     15.3         224      5550   male 2008   3.294118\n213    Gentoo    Biscoe     45.3     13.8         208      4200 female 2008   3.282609\n214    Gentoo    Biscoe     46.2     14.9         221      5300   male 2008   3.100671\n215    Gentoo    Biscoe     45.7     13.9         214      4400 female 2008   3.287770\n216    Gentoo    Biscoe     54.3     15.7         231      5650   male 2008   3.458599\n217    Gentoo    Biscoe     45.8     14.2         219      4700 female 2008   3.225352\n218    Gentoo    Biscoe     49.8     16.8         230      5700   male 2008   2.964286\n219    Gentoo    Biscoe     46.2     14.4         214      4650   <NA> 2008   3.208333\n220    Gentoo    Biscoe     49.5     16.2         229      5800   male 2008   3.055556\n221    Gentoo    Biscoe     43.5     14.2         220      4700 female 2008   3.063380\n222    Gentoo    Biscoe     50.7     15.0         223      5550   male 2008   3.380000\n223    Gentoo    Biscoe     47.7     15.0         216      4750 female 2008   3.180000\n224    Gentoo    Biscoe     46.4     15.6         221      5000   male 2008   2.974359\n225    Gentoo    Biscoe     48.2     15.6         221      5100   male 2008   3.089744\n226    Gentoo    Biscoe     46.5     14.8         217      5200 female 2008   3.141892\n227    Gentoo    Biscoe     46.4     15.0         216      4700 female 2008   3.093333\n228    Gentoo    Biscoe     48.6     16.0         230      5800   male 2008   3.037500\n229    Gentoo    Biscoe     47.5     14.2         209      4600 female 2008   3.345070\n230    Gentoo    Biscoe     51.1     16.3         220      6000   male 2008   3.134969\n231    Gentoo    Biscoe     45.2     13.8         215      4750 female 2008   3.275362\n232    Gentoo    Biscoe     45.2     16.4         223      5950   male 2008   2.756098\n233    Gentoo    Biscoe     49.1     14.5         212      4625 female 2009   3.386207\n234    Gentoo    Biscoe     52.5     15.6         221      5450   male 2009   3.365385\n235    Gentoo    Biscoe     47.4     14.6         212      4725 female 2009   3.246575\n236    Gentoo    Biscoe     50.0     15.9         224      5350   male 2009   3.144654\n237    Gentoo    Biscoe     44.9     13.8         212      4750 female 2009   3.253623\n238    Gentoo    Biscoe     50.8     17.3         228      5600   male 2009   2.936416\n239    Gentoo    Biscoe     43.4     14.4         218      4600 female 2009   3.013889\n240    Gentoo    Biscoe     51.3     14.2         218      5300   male 2009   3.612676\n241    Gentoo    Biscoe     47.5     14.0         212      4875 female 2009   3.392857\n242    Gentoo    Biscoe     52.1     17.0         230      5550   male 2009   3.064706\n243    Gentoo    Biscoe     47.5     15.0         218      4950 female 2009   3.166667\n244    Gentoo    Biscoe     52.2     17.1         228      5400   male 2009   3.052632\n245    Gentoo    Biscoe     45.5     14.5         212      4750 female 2009   3.137931\n246    Gentoo    Biscoe     49.5     16.1         224      5650   male 2009   3.074534\n247    Gentoo    Biscoe     44.5     14.7         214      4850 female 2009   3.027211\n248    Gentoo    Biscoe     50.8     15.7         226      5200   male 2009   3.235669\n249    Gentoo    Biscoe     49.4     15.8         216      4925   male 2009   3.126582\n250    Gentoo    Biscoe     46.9     14.6         222      4875 female 2009   3.212329\n251    Gentoo    Biscoe     48.4     14.4         203      4625 female 2009   3.361111\n252    Gentoo    Biscoe     51.1     16.5         225      5250   male 2009   3.096970\n253    Gentoo    Biscoe     48.5     15.0         219      4850 female 2009   3.233333\n254    Gentoo    Biscoe     55.9     17.0         228      5600   male 2009   3.288235\n255    Gentoo    Biscoe     47.2     15.5         215      4975 female 2009   3.045161\n256    Gentoo    Biscoe     49.1     15.0         228      5500   male 2009   3.273333\n257    Gentoo    Biscoe     47.3     13.8         216      4725   <NA> 2009   3.427536\n258    Gentoo    Biscoe     46.8     16.1         215      5500   male 2009   2.906832\n259    Gentoo    Biscoe     41.7     14.7         210      4700 female 2009   2.836735\n260    Gentoo    Biscoe     53.4     15.8         219      5500   male 2009   3.379747\n261    Gentoo    Biscoe     43.3     14.0         208      4575 female 2009   3.092857\n262    Gentoo    Biscoe     48.1     15.1         209      5500   male 2009   3.185430\n263    Gentoo    Biscoe     50.5     15.2         216      5000 female 2009   3.322368\n264    Gentoo    Biscoe     49.8     15.9         229      5950   male 2009   3.132075\n265    Gentoo    Biscoe     43.5     15.2         213      4650 female 2009   2.861842\n266    Gentoo    Biscoe     51.5     16.3         230      5500   male 2009   3.159509\n267    Gentoo    Biscoe     46.2     14.1         217      4375 female 2009   3.276596\n268    Gentoo    Biscoe     55.1     16.0         230      5850   male 2009   3.443750\n269    Gentoo    Biscoe     44.5     15.7         217      4875   <NA> 2009   2.834395\n270    Gentoo    Biscoe     48.8     16.2         222      6000   male 2009   3.012346\n271    Gentoo    Biscoe     47.2     13.7         214      4925 female 2009   3.445255\n272    Gentoo    Biscoe       NA       NA          NA        NA   <NA> 2009         NA\n273    Gentoo    Biscoe     46.8     14.3         215      4850 female 2009   3.272727\n274    Gentoo    Biscoe     50.4     15.7         222      5750   male 2009   3.210191\n275    Gentoo    Biscoe     45.2     14.8         212      5200 female 2009   3.054054\n276    Gentoo    Biscoe     49.9     16.1         213      5400   male 2009   3.099379\n277 Chinstrap     Dream     46.5     17.9         192      3500 female 2007   2.597765\n278 Chinstrap     Dream     50.0     19.5         196      3900   male 2007   2.564103\n279 Chinstrap     Dream     51.3     19.2         193      3650   male 2007   2.671875\n280 Chinstrap     Dream     45.4     18.7         188      3525 female 2007   2.427807\n281 Chinstrap     Dream     52.7     19.8         197      3725   male 2007   2.661616\n282 Chinstrap     Dream     45.2     17.8         198      3950 female 2007   2.539326\n283 Chinstrap     Dream     46.1     18.2         178      3250 female 2007   2.532967\n284 Chinstrap     Dream     51.3     18.2         197      3750   male 2007   2.818681\n285 Chinstrap     Dream     46.0     18.9         195      4150 female 2007   2.433862\n286 Chinstrap     Dream     51.3     19.9         198      3700   male 2007   2.577889\n287 Chinstrap     Dream     46.6     17.8         193      3800 female 2007   2.617978\n288 Chinstrap     Dream     51.7     20.3         194      3775   male 2007   2.546798\n289 Chinstrap     Dream     47.0     17.3         185      3700 female 2007   2.716763\n290 Chinstrap     Dream     52.0     18.1         201      4050   male 2007   2.872928\n291 Chinstrap     Dream     45.9     17.1         190      3575 female 2007   2.684211\n292 Chinstrap     Dream     50.5     19.6         201      4050   male 2007   2.576531\n293 Chinstrap     Dream     50.3     20.0         197      3300   male 2007   2.515000\n294 Chinstrap     Dream     58.0     17.8         181      3700 female 2007   3.258427\n295 Chinstrap     Dream     46.4     18.6         190      3450 female 2007   2.494624\n296 Chinstrap     Dream     49.2     18.2         195      4400   male 2007   2.703297\n297 Chinstrap     Dream     42.4     17.3         181      3600 female 2007   2.450867\n298 Chinstrap     Dream     48.5     17.5         191      3400   male 2007   2.771429\n299 Chinstrap     Dream     43.2     16.6         187      2900 female 2007   2.602410\n300 Chinstrap     Dream     50.6     19.4         193      3800   male 2007   2.608247\n301 Chinstrap     Dream     46.7     17.9         195      3300 female 2007   2.608939\n302 Chinstrap     Dream     52.0     19.0         197      4150   male 2007   2.736842\n303 Chinstrap     Dream     50.5     18.4         200      3400 female 2008   2.744565\n304 Chinstrap     Dream     49.5     19.0         200      3800   male 2008   2.605263\n305 Chinstrap     Dream     46.4     17.8         191      3700 female 2008   2.606742\n306 Chinstrap     Dream     52.8     20.0         205      4550   male 2008   2.640000\n307 Chinstrap     Dream     40.9     16.6         187      3200 female 2008   2.463855\n308 Chinstrap     Dream     54.2     20.8         201      4300   male 2008   2.605769\n309 Chinstrap     Dream     42.5     16.7         187      3350 female 2008   2.544910\n310 Chinstrap     Dream     51.0     18.8         203      4100   male 2008   2.712766\n311 Chinstrap     Dream     49.7     18.6         195      3600   male 2008   2.672043\n312 Chinstrap     Dream     47.5     16.8         199      3900 female 2008   2.827381\n313 Chinstrap     Dream     47.6     18.3         195      3850 female 2008   2.601093\n314 Chinstrap     Dream     52.0     20.7         210      4800   male 2008   2.512077\n315 Chinstrap     Dream     46.9     16.6         192      2700 female 2008   2.825301\n316 Chinstrap     Dream     53.5     19.9         205      4500   male 2008   2.688442\n317 Chinstrap     Dream     49.0     19.5         210      3950   male 2008   2.512821\n318 Chinstrap     Dream     46.2     17.5         187      3650 female 2008   2.640000\n319 Chinstrap     Dream     50.9     19.1         196      3550   male 2008   2.664921\n320 Chinstrap     Dream     45.5     17.0         196      3500 female 2008   2.676471\n321 Chinstrap     Dream     50.9     17.9         196      3675 female 2009   2.843575\n322 Chinstrap     Dream     50.8     18.5         201      4450   male 2009   2.745946\n323 Chinstrap     Dream     50.1     17.9         190      3400 female 2009   2.798883\n324 Chinstrap     Dream     49.0     19.6         212      4300   male 2009   2.500000\n325 Chinstrap     Dream     51.5     18.7         187      3250   male 2009   2.754011\n326 Chinstrap     Dream     49.8     17.3         198      3675 female 2009   2.878613\n327 Chinstrap     Dream     48.1     16.4         199      3325 female 2009   2.932927\n328 Chinstrap     Dream     51.4     19.0         201      3950   male 2009   2.705263\n329 Chinstrap     Dream     45.7     17.3         193      3600 female 2009   2.641618\n330 Chinstrap     Dream     50.7     19.7         203      4050   male 2009   2.573604\n331 Chinstrap     Dream     42.5     17.3         187      3350 female 2009   2.456647\n332 Chinstrap     Dream     52.2     18.8         197      3450   male 2009   2.776596\n333 Chinstrap     Dream     45.2     16.6         191      3250 female 2009   2.722892\n334 Chinstrap     Dream     49.3     19.9         203      4050   male 2009   2.477387\n335 Chinstrap     Dream     50.2     18.8         202      3800   male 2009   2.670213\n336 Chinstrap     Dream     45.6     19.4         194      3525 female 2009   2.350515\n337 Chinstrap     Dream     51.9     19.5         206      3950   male 2009   2.661538\n338 Chinstrap     Dream     46.8     16.5         189      3650 female 2009   2.836364\n339 Chinstrap     Dream     45.7     17.0         195      3650 female 2009   2.688235\n340 Chinstrap     Dream     55.8     19.8         207      4000   male 2009   2.818182\n341 Chinstrap     Dream     43.5     18.1         202      3400 female 2009   2.403315\n342 Chinstrap     Dream     49.6     18.2         193      3775   male 2009   2.725275\n343 Chinstrap     Dream     50.8     19.0         210      4100   male 2009   2.673684\n344 Chinstrap     Dream     50.2     18.7         198      3775 female 2009   2.684492\n```\n\n\n:::\n:::\n\n\n\n## Iteration in R\n\nWe also have:\n\n-   `group_by()` with `summarize()` *(for every group, do this summary)*\n\n-   `ggplot2::facet_wrap()` *(for every level of a factor, make a plot)*\n\n-   `*apply()` and `purrr::map*()` and *(for every element of a list/vector, do this function)*\n\n\n## Why iteration?\n\nDoing the same operation multiple times:\n\n- Process multiple files\n- Analyze data from multiple sites\n- Apply the same transformation to multiple columns\n- Run simulations\n\n. . .\n\n**Goal**: Write code that is:\n\n- Less repetitive\n- Easier to maintain\n- Harder to make mistakes in\n\n# Loops\n\n## Basic `for` loop syntax\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (item in vector_or_list) {\n  # item takes on each value in vector\n  # Do something with item\n}\n```\n:::\n\n\n<br>\n\n. . .\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n\nfor (park in parks) {\n  print(paste(\"Processing\", park))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Processing Banff\"\n[1] \"Processing Jasper\"\n[1] \"Processing Yoho\"\n[1] \"Processing Riding Mountain\"\n```\n\n\n:::\n:::\n\n\n## Loop over values vs indices\n\n**Loop over values** when you only need the *value* of each element.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n\nfor (park in parks) {\n  print(paste(\"Processing\", park))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Processing Banff\"\n[1] \"Processing Jasper\"\n[1] \"Processing Yoho\"\n[1] \"Processing Riding Mountain\"\n```\n\n\n:::\n:::\n\n\n. . .\n\n**Loop over indices** when you need to know the *position*.\n\n## When to use indices\n\nUse `seq_along()`, `seq_len()`, `seq()` when you need to:\n\n1. **Access the same position in multiple objects**:\n\n::: {.cell}\n\n```{.r .cell-code}\nparks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\nprovinces <- c(\"Alberta\", \"Alberta\", \"British Columbia\", \"Manitoba\")\n\nfor (i in seq_along(parks)) {\n  print(paste(parks[i], \"is in\", provinces[i]))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Banff is in Alberta\"\n[1] \"Jasper is in Alberta\"\n[1] \"Yoho is in British Columbia\"\n[1] \"Riding Mountain is in Manitoba\"\n```\n\n\n:::\n:::\n\n\n. . . \n\n2. **Store results at specific positions**:\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- vector(\"list\", length(files))\n\nfor (i in seq_along(files)) {\n  results[[i]] <- read_csv(files[i])\n}\n```\n:::\n\n\n\n## Example: Reading multiple files\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(dplyr)\n\nfiles <- list.files(\"data/\", pattern = \"\\\\.csv$\", full.names = TRUE)\n\ndata_list <- vector(mode = \"list\", length = length(files))\n\nfor (i in seq_along(files)) {\n  data_list[[i]] <- read_csv(files[i])\n}\n\n# Combine into one data frame\nall_data <- rbind_list(data_list)\n```\n:::\n\n\n## Your Turn: Create a `for` loop to make and save plots for each rodent site (plot)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrodents <- read_csv(\"PortalData/Rodents/Portal_rodent.csv\")\n\nrodent_counts <- rodents |>\n  filter(species == \"DM\") |>\n  group_by(year, plot) |>\n  summarise(n = n()) |>\n  ungroup()\n```\n:::\n\n\n<br>\n\n. . .\n\nStarting code in `04-iteration.R`\n\n## `while` loops\n\n- Loop continues *while* the condition is `TRUE`\n- Stops when the condition is `FALSE`.\n\n::: columns\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwhile (condition_is_true) {\n  # Do something\n}\n```\n:::\n\n\n:::\n\n::: {.column width=\"50%\"}\n::: fragment\n\n\n::: {.cell}\n\n```{.r .cell-code}\ni <- 1\nwhile (i < 6) {\n  print(i)\n  i <- i + 1\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n[1] 2\n[1] 3\n[1] 4\n[1] 5\n```\n\n\n:::\n:::\n\n\n:::\n:::\n:::\n\n. . . \n\nUse when you don't know in advance how many iterations you'll need.\n\n. . . \n\nUsually need to advance the iterator inside the loop.\n\n## While loop example: Simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate until estimate stabilizes\nestimate <- 0\nprevious <- Inf\ntolerance <- 0.001\nn <- 100\nreps <- 0\n\nwhile (abs(estimate - previous) > tolerance) {\n  previous <- estimate\n  sample_data <- rnorm(n, mean = 5, sd = 2)\n  estimate <- mean(sample_data)\n  n <- n + 100\n  reps <- reps + 1\n}\nn\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 600\n```\n\n\n:::\n\n```{.r .cell-code}\nreps\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5\n```\n\n\n:::\n:::\n\n\n::: {.notes}\nThis code simulates data repeatedly until the estimated mean stabilizes within a tolerance threshold:\n\nInitialize: Start with an estimate of 0, track the previous estimate, set a tolerance of 0.001, and begin with sample size 100\n\nLoop: Continue while the change in estimate exceeds the tolerance\n\nSave current estimate as previous\nGenerate random normal data (mean=5, sd=2) with current sample size\nCalculate new estimate (mean of sample)\nIncrease sample size by 100\nResult: Stops when consecutive estimates differ by less than 0.001\n\nThis demonstrates the law of large numbers - as sample size increases, the sample mean converges to the true population mean (5). The loop automatically determines how many observations are needed for the estimate to stabilize.\n:::\n\nRarely needed in data analysis work.\n\n# Iterating with `{purrr}`\n\n## Functional programming\n\n\"functional programming\" because functions take other functions as input\n\n-   modifying multiple columns `dplyr::across()`\n\n-   reading multiple files `purrr::map()` and friends\n\n-   saving multiple outputs `purrr::walk()`\n\n## Why `purrr`?\n\nThe `purrr` package provides tools for functional programming:\n\n- Clearer intent than loops\n- Less boilerplate code\n- Type-safe variants\n- Works seamlessly with pipes\n\n## Fundamental paradigms\n\nFunctional programming has three fundamental paradigms; they act on lists or vectors:\n\n::: incremental\n-   `map` - do *this* to each element: `purrr::map()`\n-   `filter` - like spaghetti, not coffee: `purrr::keep()`\n-   `reduce` - combine into new thing: `purrr::reduce()`\n:::\n\n. . .\n\nEach of these takes a *function* as an argument, to tell the operator *what* to do.\n\n. . . \n\nWe are going to focus on `map()` and friends.\n\n## `map()`: Apply a function to each element\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparks <- c(\"Banff\", \"Jasper\", \"Yoho\", \"Riding Mountain\")\n```\n:::\n\n\n<br>\n\n::: {.columns}\n::: {.column width=\"50%\"}\n\n::: fragment\n\n### `for` loop:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (park in parks) {\n  print(nchar(park))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5\n[1] 6\n[1] 4\n[1] 15\n```\n\n\n:::\n:::\n\n\n:::\n:::\n::: {.column width=\"50%\"}\n\n::: fragment\n### `map()`\n\n`map(.x, .f)` applies function `.f` to each element of `.x`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap(parks, nchar)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] 5\n\n[[2]]\n[1] 6\n\n[[3]]\n[1] 4\n\n[[4]]\n[1] 15\n```\n\n\n:::\n:::\n\n\n::: fragment\n\nReturns a **list** by default.\n\n:::\n:::\n:::\n:::\n\n## Review of lists\n\nLists are like vectors, but instead of each element being a single value, each \nelement can be a more complex object (vector, data-frame, function, etc.)\n\n::: columns\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_list <- list(\n  c(1, 2, 3),\n  c(\"a\", \"b\", \"c\"),\n  data.frame(x = 1:3, y = c(\"A\", \"B\", \"C\"))\n)\nmy_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] 1 2 3\n\n[[2]]\n[1] \"a\" \"b\" \"c\"\n\n[[3]]\n  x y\n1 1 A\n2 2 B\n3 3 C\n```\n\n\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_named_list <- list(\n  numbers = c(1, 2, 3),\n  letters = c(\"a\", \"b\", \"c\"),\n  df = data.frame(x = 1:3, y = c(\"A\", \"B\", \"C\"))\n)\nmy_named_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$numbers\n[1] 1 2 3\n\n$letters\n[1] \"a\" \"b\" \"c\"\n\n$df\n  x y\n1 1 A\n2 2 B\n3 3 C\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(my_named_list)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"numbers\" \"letters\" \"df\"     \n```\n\n\n:::\n:::\n\n\n:::\n:::\n\n## Type-specific map variants\n\n`map_*()` functions return ***atomic* vectors** of specific types:\n\n- `map_dbl()` → numeric vector\n- `map_chr()` → character vector\n- `map_int()` → integer vector\n- `map_lgl()` → logical vector\n\n## Type-specific map variants\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_dbl(parks, nchar)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  5  6  4 15\n```\n\n\n:::\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_chr(parks, toupper)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"BANFF\"           \"JASPER\"          \"YOHO\"            \"RIDING MOUNTAIN\"\n```\n\n\n:::\n:::\n\n\n<br>\n\n. . .\n\n**Note:** These are simple examples to illustrate, but `nchar()` and `toupper()` are already vectorized, so you wouldn't normally use `map()` for them.\n\n<br>\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnchar(parks)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  5  6  4 15\n```\n\n\n:::\n\n```{.r .cell-code}\ntoupper(parks)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"BANFF\"           \"JASPER\"          \"YOHO\"            \"RIDING MOUNTAIN\"\n```\n\n\n:::\n:::\n\n\n## Anonymous functions\n\n```r\nmap(.x, .f)\n```\n\nThe `.f` argument to `map()` can be:\n\n-   a named function (e.g., `nchar`, `toupper`)\n-   an anonymous function (a function defined *in place*)\n\n## Syntax for anonymous functions:\n\n::: {.columns}\n::: {.column}\n\nIf simple, on one line:\n\n``` r\n\\(x) what to do with x\n```\n\n<br>\n\n::: {.fragment}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum <- 1:4\nmap(num, \\(x) x + 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] 2\n\n[[2]]\n[1] 3\n\n[[3]]\n[1] 4\n\n[[4]]\n[1] 5\n```\n\n\n:::\n:::\n\n\n:::\n:::\n::: {.column}\n\n::: {.fragment}\n\nOr more complex:\n\n``` r\n\\(arg1, arg2, ...) {\n  # function body\n}\n```\n\n:::\n\n<br>\n\n::: {.fragment}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum <- 1:4\nmap(num, \\(x) {\n  y <- x^2\n  z <- y + 3\n  z\n})\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] 4\n\n[[2]]\n[1] 7\n\n[[3]]\n[1] 12\n\n[[4]]\n[1] 19\n```\n\n\n:::\n:::\n\n\n:::\n:::\n:::\n\n## Map: Atomic variants\n\n::::: columns\n::: {.column width=\"50%\"}\n`map()` always returns a list:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum <- 1:4\nmap(num, \\(x) x + 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] 2\n\n[[2]]\n[1] 3\n\n[[3]]\n[1] 4\n\n[[4]]\n[1] 5\n```\n\n\n:::\n:::\n\n\n:::\n\n::: {.column width=\"50%\"}\nUse an atomic variant to specify type:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum <- 1:4\nmap_int(num, \\(x) x + 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2 3 4 5\n```\n\n\n:::\n:::\n\n\n:::\n:::::\n\n## Reading multiple files\n\nIteration functions in {purrr} can help with repetitive tasks.\n\n. . .\n\n### Example\n\nRead Excel files from a directory, then combine into a single data-frame.\n\n## Our turn: Reading data manually\n\nHere's our starting code:\n\n``` r\ndata1952 <- read_excel(\"data/gapminder/1952.xlsx\")\ndata1957 <- read_excel(\"data/gapminder/1957.xlsx\")\ndata1962 <- read_excel(\"data/gapminder/1952.xlsx\")\ndata1967 <- read_excel(\"data/gapminder/1967.xlsx\")\n\ndata_manual <- bind_rows(data1952, data1957, data1962, data1967)\n```\n\n. . .\n\nWhat problems do you see?\n\n(I see one real problem, and one philosophical problem)\n\n<br>\n\n. . .\n\nStarting code in `04-iteration.R`\n\n## Our turn: Make list of paths\n\nI see this as a two step problem:\n\n::: incremental\n-   make a named list of paths, name is year\n-   use list of paths to read data frames, combine\n:::\n\n. . .\n\nLet's work together to improve this code to get paths:\n\n``` r\npaths <-\n  # get the filepaths from the directory\n  fs::dir_ls(\"data/gapminder\") |>\n  # extract the year as names\n```\n\n## Our turn: Read data\n\nLet's work together to improve this code to read data:\n\n``` r\ndata <-\n  paths |>\n  # read each file from excel, into data frame\n  # set list-names as column `year`\n  # bind into single data-frame\n  # convert year to number\n```\n\n## Map over two inputs\n\nSometimes you need to map over two inputs that are the same length.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparams1 <- c(1, 2, 3)\nparams2 <- c(10, 20, 30)\n\nmap2(\n  params1,\n  params2,\n  \\(x, y) x + y\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] 11\n\n[[2]]\n[1] 22\n\n[[3]]\n[1] 33\n```\n\n\n:::\n:::\n\n\n. . .\n\n**Vector variants:** `map2_dbl()`, `map2_chr()`, etc.\n\n## `purrr::walk()`\n\nFor functions called for their *side effects* (i.e., not for their return value)\n\nUseful for:\n\n- writing data files\n- saving plots\n- `walk2()` for two inputs\n\n. . . \n\n\n::: {.cell}\n\n```{.r .cell-code}\nwalk2(\n  list_of_dataframes,\n  list_of_filepaths,\n  \\(df, f) {\n    write_csv(df, f)\n  }\n)\n```\n:::\n\n\n## Your turn\n\nUsing our first example with the rodent data, use `purrr` instead of a `for`\nloop to:\n\n1. Make a list of plots\n2. Save plots for each rodent site (plot)\n\n<br>\n\n. . .\n\nStarting code in `04-iteration.R`\n\n## Summary\n\n- **Loops** are explicit but verbose\n- **Functional programming** (`purrr`) is usually clearer and efficient\n- Use `map_*()` to iterate over lists/vectors\n- Use `walk()` (and variants) for side effects\n- `purrr` functions can be parallelized with `in_parallel()`\n\n## Resources\n\n- R4DS chapter on iteration: <https://r4ds.hadley.nz/iteration>\n- purrr documentation: <https://purrr.tidyverse.org/>\n- tidyverse blog on purrr: <https://tidyverse.org/blog/2023/05/purrr-walk-this-way/>\n- Parallel processing with purrr: <https://purrr.tidyverse.org/articles/parallel.html>\n",
    "supporting": [
      "programming-iteration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}